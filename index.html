<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SSU Training">
    <meta name="theme-color" content="#060D1A">
    <title>SSU Training Portal | Quantum Circuit</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=Montserrat:wght@400;600;700;900&family=Oswald:wght@500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #060D1A;
            --bg-secondary: #0c1829;
            --bg-tertiary: #122036;
            --bg-input: #162340;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #5a6a85;
            --border: #1e3354;
            --border-light: #2a4470;
            --accent-cyan: #00F5D4;
            --accent-blue: #00BBF9;
            --accent-violet: #9B5DE5;
            --accent-red: #E63946;
            --accent-gold: #F4D35E;
            --navy: #1D3557;
            --accent-green: #4ade80;
            --shadow: 0 25px 50px -12px rgba(0,0,0,0.6);
            --shadow-sm: 0 4px 20px rgba(0,0,0,0.4);
            --card-bg: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            --quantum-grad: linear-gradient(135deg, #00F5D4 0%, #00BBF9 50%, #9B5DE5 100%);
            --level-fund: #00F5D4;
            --level-1: #22c55e;
            --level-2: #00BBF9;
            --level-3: #9B5DE5;
            --level-4: #f97316;
        }
        [data-theme="light"] {
            --bg-primary: #f0f4f8;
            --bg-secondary: #ffffff;
            --bg-tertiary: #e8edf4;
            --bg-input: #dce4ef;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #64748b;
            --border: #c2cfe0;
            --border-light: #94a3b8;
            --shadow: 0 25px 50px -12px rgba(0,0,0,0.12);
            --shadow-sm: 0 4px 20px rgba(0,0,0,0.06);
            --card-bg: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
        }
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:'Montserrat',sans-serif; background:var(--bg-primary); color:var(--text-primary); min-height:100vh; line-height:1.6; transition:background .3s,color .3s; }
        .hidden { display:none !important; }
        /* Theme Toggle */
        .theme-toggle { position:fixed;top:1rem;right:1rem;z-index:10000;display:flex;align-items:center;gap:.5rem;background:var(--bg-secondary);border:1px solid var(--border);border-radius:30px;padding:.4rem .75rem;cursor:pointer;transition:all .3s;box-shadow:var(--shadow-sm); }
        .theme-toggle:hover { border-color:var(--accent-cyan); }
        .theme-toggle-icon { font-size:1.1rem; }
        .theme-toggle-label { font-size:.7rem;font-weight:600;color:var(--text-secondary);letter-spacing:.05em; }
        /* Landing */
        .landing-page { min-height:100vh;display:flex;flex-direction:column; }
        .landing-hero { flex:1;display:flex;align-items:center;justify-content:center;padding:2rem;background:var(--card-bg);position:relative;overflow:hidden; }
        .landing-hero::before { content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(circle at 30% 40%,rgba(0,245,212,.06) 0%,transparent 50%),radial-gradient(circle at 70% 60%,rgba(155,93,229,.04) 0%,transparent 50%);pointer-events:none; }
        .landing-content { max-width:950px;text-align:center;position:relative;z-index:1; }
        .landing-logo { width:140px;height:140px;margin:0 auto 2rem; }
        .landing-logo svg { width:100%;height:100%; }
        .landing-title { font-family:'Oswald',sans-serif;font-size:clamp(2.2rem,5vw,3.8rem);font-weight:700;letter-spacing:.08em;margin-bottom:.25rem; }
        .landing-subtitle { font-size:.95rem;font-family:'Rajdhani',sans-serif;font-weight:600;letter-spacing:.25em;margin-bottom:1.5rem;background:var(--quantum-grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text; }
        .landing-description { font-size:1rem;color:var(--text-secondary);max-width:650px;margin:0 auto 2.5rem;line-height:1.8; }
        .landing-features { display:grid;grid-template-columns:repeat(auto-fit,minmax(155px,1fr));gap:1.25rem;margin-bottom:3rem; }
        .feature-card { background:var(--bg-secondary);border:1px solid var(--border);border-radius:16px;padding:1.4rem 1.1rem;text-align:center;transition:all .3s; }
        .feature-card:hover { transform:translateY(-4px);border-color:var(--accent-blue); }
        .feature-icon { font-size:2rem;margin-bottom:.6rem; }
        .feature-title { font-family:'Rajdhani',sans-serif;font-weight:700;font-size:.95rem;margin-bottom:.2rem; }
        .feature-desc { font-size:.75rem;color:var(--text-muted); }
        .landing-cta { display:flex;flex-wrap:wrap;gap:1rem;justify-content:center; }
        .btn-landing { padding:1rem 2rem;border-radius:12px;font-family:'Montserrat',sans-serif;font-size:1rem;font-weight:600;cursor:pointer;transition:all .3s;display:inline-flex;align-items:center;gap:.5rem;border:2px solid transparent; }
        .btn-primary-q { background:var(--quantum-grad);color:#060D1A; }
        .btn-primary-q:hover { transform:translateY(-2px);box-shadow:0 10px 30px rgba(0,245,212,.25); }
        .btn-secondary { background:transparent;border-color:var(--border);color:var(--text-primary); }
        .btn-secondary:hover { border-color:var(--accent-cyan);background:var(--bg-tertiary); }
        .landing-footer { padding:1.5rem;text-align:center;border-top:1px solid var(--border);background:var(--bg-secondary); }
        /* Login */
        .login-page { min-height:100vh;display:none;align-items:center;justify-content:center;padding:2rem;background:var(--bg-primary); }
        .login-page.active { display:flex; }
        .login-container { width:100%;max-width:440px; }
        .login-card { background:var(--card-bg);border:1px solid var(--border);border-radius:24px;padding:2.5rem;box-shadow:var(--shadow); }
        .login-header { text-align:center;margin-bottom:2rem; }
        .login-logo { width:80px;height:80px;margin:0 auto 1rem; }
        .login-logo svg { width:100%;height:100%; }
        .login-title { font-family:'Oswald',sans-serif;font-size:1.5rem;font-weight:700;letter-spacing:.08em; }
        .login-subtitle { color:var(--text-muted);font-size:.85rem; }
        .login-form { display:flex;flex-direction:column;gap:1.25rem; }
        .form-group { display:flex;flex-direction:column;gap:.5rem; }
        .form-label { font-size:.75rem;font-weight:600;color:var(--text-secondary);text-transform:uppercase;letter-spacing:.5px;font-family:'Rajdhani',sans-serif; }
        .form-input-wrapper { position:relative;display:flex;align-items:center; }
        .form-input { width:100%;background:var(--bg-input);border:2px solid var(--border);border-radius:12px;padding:.9rem 1rem;font-size:1rem;color:var(--text-primary);font-family:'Montserrat',sans-serif;transition:all .2s; }
        .form-input:focus { outline:none;border-color:var(--accent-cyan);box-shadow:0 0 0 3px rgba(0,245,212,.12); }
        .form-input::placeholder { color:var(--text-muted); }
        .form-input.has-icon { padding-right:3rem; }
        .password-toggle { position:absolute;right:.75rem;background:none;border:none;color:var(--text-muted);cursor:pointer;padding:.5rem;font-size:1.1rem;transition:color .2s; }
        .password-toggle:hover { color:var(--accent-cyan); }
        .form-row { display:flex;justify-content:space-between;align-items:center; }
        .remember-me { display:flex;align-items:center;gap:.5rem;cursor:pointer; }
        .remember-me input { width:18px;height:18px;accent-color:var(--accent-cyan); }
        .remember-me span { font-size:.8rem;color:var(--text-secondary); }
        .forgot-link { font-size:.8rem;color:var(--accent-cyan);text-decoration:none; }
        .login-btn { width:100%;background:var(--quantum-grad);color:#060D1A;border:none;border-radius:12px;padding:1rem;font-size:1rem;font-weight:700;cursor:pointer;transition:all .3s;font-family:'Montserrat',sans-serif; }
        .login-btn:hover { transform:translateY(-2px);box-shadow:0 10px 30px rgba(0,245,212,.25); }
        .login-error { display:none;background:rgba(230,57,70,.1);border:1px solid rgba(230,57,70,.3);border-radius:10px;padding:.75rem 1rem;color:#fca5a5;font-size:.85rem;text-align:center; }
        .login-error.show { display:block; }
        [data-theme="light"] .login-error { color:#dc2626; }
        .login-footer-wrap { text-align:center;margin-top:1.5rem;padding-top:1.5rem;border-top:1px solid var(--border); }
        .login-footer-text { font-size:.75rem;color:var(--text-muted); }
        .back-link { display:inline-flex;align-items:center;gap:.4rem;color:var(--text-secondary);text-decoration:none;font-size:.8rem;margin-top:1rem;transition:color .2s; }
        .back-link:hover { color:var(--accent-cyan); }
        /* Modal */
        .modal-overlay { position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.7);display:none;align-items:center;justify-content:center;z-index:10001;padding:1rem; }
        .modal-overlay.show { display:flex; }
        .modal-card { background:var(--bg-secondary);border:1px solid var(--border);border-radius:20px;padding:2rem;max-width:420px;width:100%;box-shadow:var(--shadow); }
        .modal-header { text-align:center;margin-bottom:1.5rem; }
        .modal-icon { font-size:3rem;margin-bottom:.75rem; }
        .modal-title { font-family:'Oswald',sans-serif;font-size:1.25rem;font-weight:700;margin-bottom:.25rem; }
        .modal-desc { color:var(--text-muted);font-size:.85rem; }
        .modal-actions { display:flex;gap:.75rem;margin-top:1.5rem; }
        .modal-btn { flex:1;padding:.85rem;border-radius:10px;font-weight:600;cursor:pointer;transition:all .2s;font-family:'Montserrat',sans-serif;font-size:.9rem; }
        .modal-btn-cancel { background:var(--bg-input);border:1px solid var(--border);color:var(--text-secondary); }
        .modal-btn-submit { background:var(--accent-cyan);border:none;color:#060D1A; }
        .modal-success { display:none;text-align:center;padding:1rem 0; }
        .modal-success.show { display:block; }
        /* App */
        .app-wrapper { display:none;min-height:100vh; }
        .app-wrapper.active { display:block; }
        .header { background:var(--card-bg);border-bottom:3px solid transparent;border-image:var(--quantum-grad) 1;padding:1rem 1.5rem;position:sticky;top:0;z-index:100; }
        .header-content { display:flex;align-items:center;justify-content:space-between;gap:1rem;flex-wrap:wrap;max-width:1400px;margin:0 auto; }
        .logo-section { display:flex;align-items:center;gap:.75rem; }
        .logo-icon { width:44px;height:44px; }
        .logo-icon svg { width:100%;height:100%; }
        .brand h1 { font-family:'Oswald',sans-serif;font-size:1.15rem;font-weight:700;letter-spacing:.08em; }
        .brand .tagline { font-size:.6rem;font-family:'Rajdhani',sans-serif;font-weight:600;letter-spacing:.2em;background:var(--quantum-grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text; }
        .user-section { display:flex;align-items:center;gap:1rem;flex-wrap:wrap; }
        .stat-badges { display:flex;gap:.5rem;flex-wrap:wrap; }
        .stat-badge { display:flex;align-items:center;gap:.3rem;padding:.35rem .65rem;background:var(--bg-input);border-radius:20px;font-size:.65rem;border:1px solid var(--border); }
        .stat-badge .value { font-weight:700;color:var(--accent-cyan);font-family:'JetBrains Mono',monospace; }
        .user-info { display:flex;align-items:center;gap:.6rem; }
        .user-avatar { width:38px;height:38px;background:var(--quantum-grad);color:#060D1A;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.85rem; }
        .user-details { text-align:right; }
        .user-name { font-weight:600;font-size:.85rem; }
        .user-level { font-size:.65rem;color:var(--accent-cyan);font-weight:600;font-family:'Rajdhani',sans-serif; }
        .logout-btn { display:flex;align-items:center;gap:.4rem;background:var(--bg-input);border:1px solid var(--border);padding:.45rem .75rem;border-radius:8px;color:var(--text-secondary);cursor:pointer;font-size:.7rem;font-family:'Montserrat',sans-serif;transition:all .2s; }
        .logout-btn:hover { background:var(--accent-red);color:white;border-color:var(--accent-red); }
        /* Nav */
        .nav-tabs { display:flex;gap:.4rem;padding:.75rem 1.5rem;background:var(--bg-secondary);border-bottom:1px solid var(--border);overflow-x:auto;max-width:1400px;margin:0 auto; }
        .nav-tab { padding:.65rem 1rem;border-radius:8px;font-size:.75rem;font-weight:600;color:var(--text-muted);cursor:pointer;transition:all .2s;white-space:nowrap;border:1px solid transparent;font-family:'Rajdhani',sans-serif;letter-spacing:.03em; }
        .nav-tab:hover { color:var(--text-primary);background:var(--bg-tertiary); }
        .nav-tab.active { background:var(--bg-tertiary);color:var(--accent-cyan);border-color:var(--border); }
        /* Sections */
        .app-section { display:none;padding:1.5rem;max-width:1200px;margin:0 auto; }
        .app-section.active { display:block; }
        .section-title { font-family:'Oswald',sans-serif;font-size:1.3rem;font-weight:700;margin-bottom:1.25rem;letter-spacing:.05em; }
        /* Cards */
        .level-grid { display:grid;grid-template-columns:repeat(auto-fit,minmax(130px,1fr));gap:1rem;margin-bottom:2rem; }
        .level-card { background:var(--bg-secondary);border:1px solid var(--border);border-radius:14px;padding:1.25rem;text-align:center;cursor:pointer;transition:all .3s; }
        .level-card:hover { transform:translateY(-3px);border-color:var(--border-light);box-shadow:var(--shadow-sm); }
        .level-name { font-family:'Oswald',sans-serif;font-size:1.4rem;font-weight:700;margin-bottom:.25rem; }
        .level-desc { font-size:.7rem;color:var(--text-muted);margin-bottom:.25rem; }
        .level-status { font-size:.65rem;color:var(--text-secondary);font-family:'JetBrains Mono',monospace; }
        .category-grid { display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:1rem;margin-bottom:2rem; }
        .category-card { background:var(--bg-secondary);border:1px solid var(--border);border-radius:14px;padding:1.25rem;text-align:center;cursor:pointer;transition:all .3s; }
        .category-card:hover { transform:translateY(-3px);border-color:var(--accent-blue); }
        .category-icon { font-size:1.8rem;margin-bottom:.5rem; }
        .category-name { font-family:'Rajdhani',sans-serif;font-weight:700;font-size:.9rem;margin-bottom:.15rem; }
        .category-count { font-size:.7rem;color:var(--text-muted);font-family:'JetBrains Mono',monospace; }
        /* Quiz */
        .quiz-header { display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;gap:1rem;flex-wrap:wrap; }
        .quiz-progress { flex:1; }
        .progress-text { font-size:.8rem;color:var(--text-secondary);margin-bottom:.5rem;display:block; }
        .progress-bar { height:6px;background:var(--bg-input);border-radius:3px;overflow:hidden; }
        .progress-fill { height:100%;background:var(--quantum-grad);border-radius:3px;transition:width .3s; }
        .quiz-score { font-family:'JetBrains Mono',monospace;font-size:.8rem;color:var(--text-secondary);white-space:nowrap; }
        .question-card { background:var(--bg-secondary);border:1px solid var(--border);border-radius:16px;padding:2rem;margin-bottom:1.5rem; }
        .question-meta { display:flex;gap:.75rem;margin-bottom:1rem;flex-wrap:wrap; }
        .question-level { font-size:.65rem;padding:.25rem .6rem;border-radius:6px;font-weight:600;font-family:'Rajdhani',sans-serif;letter-spacing:.05em; }
        .question-category { font-size:.65rem;padding:.25rem .6rem;background:var(--bg-input);border-radius:6px;color:var(--text-secondary); }
        .question-text { font-size:1.05rem;font-weight:600;margin-bottom:1.5rem;line-height:1.7; }
        .answer-options { display:flex;flex-direction:column;gap:.75rem; }
        .answer-option { display:flex;align-items:center;gap:1rem;padding:1rem 1.25rem;border:2px solid var(--border);border-radius:12px;cursor:pointer;transition:all .2s; }
        .answer-option:hover:not(.disabled) { border-color:var(--border-light);background:var(--bg-tertiary); }
        .answer-option.selected { border-color:var(--accent-blue);background:rgba(0,187,249,.08); }
        .answer-option.correct { border-color:var(--accent-green);background:rgba(74,222,128,.08); }
        .answer-option.incorrect { border-color:var(--accent-red);background:rgba(230,57,70,.08); }
        .answer-option.disabled { cursor:not-allowed; }
        .option-letter { width:36px;height:36px;border-radius:50%;background:var(--bg-secondary);display:flex;align-items:center;justify-content:center;font-weight:600;font-size:.9rem;flex-shrink:0;border:2px solid var(--border); }
        .answer-option.correct .option-letter { background:var(--accent-green);color:white;border-color:var(--accent-green); }
        .answer-option.incorrect .option-letter { background:var(--accent-red);color:white;border-color:var(--accent-red); }
        .option-text { flex:1;font-size:.95rem; }
        .explanation { margin-top:1.5rem;padding:1rem 1.25rem;background:var(--bg-input);border-radius:10px;border-left:4px solid var(--accent-cyan);display:none; }
        .explanation.show { display:block;animation:fadeIn .3s ease; }
        .explanation-title { font-size:.7rem;color:var(--accent-cyan);text-transform:uppercase;letter-spacing:.05em;margin-bottom:.5rem;font-weight:600;font-family:'Rajdhani',sans-serif; }
        @keyframes fadeIn { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:translateY(0)} }
        .btn-group { display:flex;gap:1rem;justify-content:center;flex-wrap:wrap; }
        .btn { padding:.85rem 1.5rem;border:none;border-radius:10px;font-family:'Montserrat',sans-serif;font-size:.9rem;font-weight:600;cursor:pointer;transition:all .2s;display:inline-flex;align-items:center;gap:.5rem; }
        .btn-primary { background:var(--quantum-grad);color:#060D1A; }
        .btn-primary:hover { transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,245,212,.2); }
        .btn-sec { background:var(--bg-secondary);border:2px solid var(--border);color:var(--text-primary); }
        .btn-sec:hover { background:var(--bg-input);border-color:var(--accent-cyan); }
        /* Results */
        .results-card { background:var(--bg-secondary);border:1px solid var(--border);border-radius:16px;padding:2.5rem;text-align:center;max-width:500px;margin:2rem auto; }
        .results-icon { font-size:3.5rem;margin-bottom:1rem; }
        .results-title { font-family:'Oswald',sans-serif;font-size:1.5rem;font-weight:700;margin-bottom:.5rem; }
        .results-score { font-size:3rem;font-weight:800;background:var(--quantum-grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin:1rem 0; }
        .results-breakdown { display:flex;justify-content:center;gap:2rem;margin:1.5rem 0; }
        .results-stat { text-align:center; }
        .results-stat-value { font-size:1.5rem;font-weight:700; }
        .results-stat-label { font-size:.75rem;color:var(--text-muted); }
        /* Flashcards */
        .flashcard-container { max-width:600px;margin:0 auto; }
        .flashcard-progress { text-align:center;margin-bottom:1.5rem;color:var(--text-muted);font-family:'JetBrains Mono',monospace;font-size:.85rem; }
        .flashcard { perspective:1000px;height:300px;cursor:pointer;margin-bottom:1.5rem; }
        .flashcard-inner { position:relative;width:100%;height:100%;transition:transform .6s;transform-style:preserve-3d; }
        .flashcard.flipped .flashcard-inner { transform:rotateY(180deg); }
        .flashcard-front,.flashcard-back { position:absolute;width:100%;height:100%;backface-visibility:hidden;border-radius:16px;padding:2rem;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center; }
        .flashcard-front { background:var(--card-bg);border:1px solid var(--border); }
        .flashcard-back { background:linear-gradient(135deg,rgba(0,245,212,.1) 0%,var(--bg-secondary) 100%);border:1px solid var(--accent-cyan);transform:rotateY(180deg); }
        .flashcard-label { font-size:.65rem;font-family:'Rajdhani',sans-serif;color:var(--text-muted);text-transform:uppercase;letter-spacing:.15em;margin-bottom:1rem; }
        .flashcard-content { font-size:1.05rem;line-height:1.6; }
        .flashcard-hint { margin-top:auto;font-size:.7rem;color:var(--text-muted); }
        .flashcard-controls { display:flex;justify-content:center;gap:1rem;flex-wrap:wrap; }
        .flashcard-btn { padding:.7rem 1.3rem;border:1px solid var(--border);border-radius:8px;background:var(--bg-secondary);color:var(--text-primary);font-family:'Montserrat',sans-serif;font-size:.85rem;cursor:pointer;transition:all .2s; }
        .flashcard-btn:hover { background:var(--bg-input);border-color:var(--border-light); }
        .flashcard-btn.correct { border-color:var(--accent-green);color:var(--accent-green); }
        .flashcard-btn.incorrect { border-color:var(--accent-red);color:var(--accent-red); }
        /* Question Bank */
        .qbank-header { display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;flex-wrap:wrap;gap:1rem; }
        .search-box { display:flex;align-items:center;background:var(--bg-secondary);border:1px solid var(--border);border-radius:8px;padding:.5rem 1rem;gap:.5rem; }
        .search-box input { background:transparent;border:none;color:var(--text-primary);font-family:'Montserrat',sans-serif;font-size:.85rem;outline:none;width:180px; }
        .search-box input::placeholder { color:var(--text-muted); }
        .filter-row { display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:1.5rem; }
        .filter-btn { padding:.45rem .85rem;background:var(--bg-secondary);border:1px solid var(--border);border-radius:8px;color:var(--text-secondary);font-size:.75rem;cursor:pointer;transition:all .2s;font-family:'Rajdhani',sans-serif;font-weight:600;letter-spacing:.03em; }
        .filter-btn:hover { border-color:var(--border-light); }
        .filter-btn.active { background:var(--accent-cyan);color:#060D1A;border-color:var(--accent-cyan); }
        .question-list { display:flex;flex-direction:column;gap:.75rem; }
        .question-item { background:var(--bg-secondary);border:1px solid var(--border);border-radius:10px;padding:1.15rem;cursor:pointer;transition:all .2s; }
        .question-item:hover { border-color:var(--border-light); }
        .question-item-header { display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:.4rem;gap:1rem; }
        .question-item-category { font-size:.65rem;color:var(--accent-cyan);text-transform:uppercase;letter-spacing:.05em;font-family:'Rajdhani',sans-serif;font-weight:600; }
        .question-item-level { font-size:.6rem;padding:.15rem .45rem;background:var(--bg-input);border-radius:4px;color:var(--text-muted); }
        .question-item-text { font-size:.9rem;color:var(--text-primary);line-height:1.5; }
        /* Calculators */
        .calc-grid { display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:1.5rem;margin-bottom:2rem; }
        .calc-card { background:var(--bg-secondary);border:1px solid var(--border);border-radius:16px;padding:1.5rem;transition:all .3s; }
        .calc-card:hover { border-color:var(--accent-blue); }
        .calc-card h3 { font-family:'Oswald',sans-serif;font-size:1.1rem;font-weight:700;margin-bottom:1rem;letter-spacing:.05em; }
        .calc-row { display:flex;align-items:center;gap:.75rem;margin-bottom:.75rem; }
        .calc-row label { font-size:.8rem;font-weight:600;min-width:100px;color:var(--text-secondary);font-family:'Rajdhani',sans-serif; }
        .calc-row input,.calc-row select { flex:1;background:var(--bg-input);border:1px solid var(--border);border-radius:8px;padding:.6rem .75rem;color:var(--text-primary);font-family:'JetBrains Mono',monospace;font-size:.85rem; }
        .calc-row input:focus,.calc-row select:focus { outline:none;border-color:var(--accent-cyan); }
        .calc-btn { width:100%;background:var(--quantum-grad);color:#060D1A;border:none;border-radius:8px;padding:.75rem;font-weight:700;cursor:pointer;font-family:'Montserrat',sans-serif;margin-top:.5rem;transition:all .2s; }
        .calc-btn:hover { transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,245,212,.2); }
        .calc-result { margin-top:1rem;padding:1rem;background:var(--bg-input);border-radius:10px;border-left:3px solid var(--accent-cyan);font-family:'JetBrains Mono',monospace;font-size:.85rem;line-height:1.8; }
        .calc-formula { margin-top:1rem;padding:.75rem;background:rgba(0,245,212,.05);border-radius:8px;font-family:'JetBrains Mono',monospace;font-size:.75rem;color:var(--accent-cyan);text-align:center; }
        /* Progress */
        .dashboard-grid { display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:1.25rem; }
        .progress-card { background:var(--bg-secondary);border:1px solid var(--border);border-radius:12px;padding:1.5rem;margin-bottom:1rem; }
        .progress-card-title { font-family:'Oswald',sans-serif;font-size:1rem;font-weight:700;margin-bottom:1rem;padding-bottom:.75rem;border-bottom:1px solid var(--border); }
        .progress-row { display:flex;justify-content:space-between;align-items:center;padding:.6rem 0;border-bottom:1px solid var(--border); }
        .progress-row:last-child { border-bottom:none; }
        .progress-label { font-size:.85rem;color:var(--text-secondary); }
        .progress-value { font-size:.85rem;font-weight:600;color:var(--accent-cyan);font-family:'JetBrains Mono',monospace; }
        /* Responsive */
        @media(max-width:768px) {
            .header-content { flex-direction:column;gap:.75rem; }
            .user-section { width:100%;justify-content:space-between; }
            .nav-tabs { padding:.6rem .75rem; }
            .quiz-header { flex-direction:column;align-items:flex-start; }
            .calc-grid { grid-template-columns:1fr; }
        }
        @media(max-width:480px) {
            .landing-features { grid-template-columns:1fr 1fr; }
            .landing-cta { flex-direction:column; }
            .btn-landing { width:100%;justify-content:center; }
            .level-grid { grid-template-columns:repeat(3,1fr); }
            .category-grid { grid-template-columns:1fr 1fr; }
        }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()"><span class="theme-toggle-icon" id="theme-icon">üåô</span><span class="theme-toggle-label" id="theme-label">DARK</span></button>
    <!-- LANDING -->
    <div id="landing-page" class="landing-page">
        <div class="landing-hero">
            <div class="landing-content">
                <div class="landing-logo">
                    <svg viewBox="0 0 140 140">
                        <defs>
                            <linearGradient id="qG" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#00F5D4"/><stop offset="50%" style="stop-color:#00BBF9"/><stop offset="100%" style="stop-color:#9B5DE5"/></linearGradient>
                            <radialGradient id="sGlow" cx="50%" cy="50%" r="50%"><stop offset="0%" style="stop-color:#00BBF9;stop-opacity:0.25"/><stop offset="100%" style="stop-color:#9B5DE5;stop-opacity:0"/></radialGradient>
                            <filter id="glow"><feGaussianBlur stdDeviation="2" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
                        </defs>
                        <rect x="8" y="30" width="24" height="24" rx="3" fill="#060D1A" stroke="#00F5D4" stroke-width="2"/>
                        <text x="20" y="47" text-anchor="middle" font-family="monospace" font-weight="700" font-size="13" fill="#00F5D4">H</text>
                        <rect x="8" y="60" width="24" height="24" rx="3" fill="#060D1A" stroke="#00BBF9" stroke-width="2"/>
                        <text x="20" y="77" text-anchor="middle" font-family="monospace" font-weight="700" font-size="13" fill="#00BBF9">X</text>
                        <rect x="8" y="90" width="24" height="24" rx="3" fill="#060D1A" stroke="#9B5DE5" stroke-width="2"/>
                        <text x="20" y="107" text-anchor="middle" font-family="monospace" font-weight="700" font-size="13" fill="#9B5DE5">S</text>
                        <line x1="38" y1="42" x2="38" y2="72" stroke="#00BBF9" stroke-width="1.5"/>
                        <circle cx="38" cy="42" r="3" fill="#00F5D4"/>
                        <circle cx="38" cy="72" r="5" fill="none" stroke="#00BBF9" stroke-width="1.5"/>
                        <line x1="34" y1="72" x2="42" y2="72" stroke="#00BBF9" stroke-width="1.5"/>
                        <line x1="38" y1="68" x2="38" y2="76" stroke="#00BBF9" stroke-width="1.5"/>
                        <path d="M 44 57 Q 54 57 60 57" fill="none" stroke="#00BBF9" stroke-width="1" opacity="0.4"/>
                        <circle cx="90" cy="65" r="40" fill="url(#sGlow)"/>
                        <circle cx="90" cy="65" r="32" fill="#060D1A" stroke="url(#qG)" stroke-width="2.5"/>
                        <ellipse cx="90" cy="65" rx="32" ry="12" fill="none" stroke="#00BBF9" stroke-width="0.5" opacity="0.25"/>
                        <line x1="90" y1="65" x2="108" y2="45" stroke="#00F5D4" stroke-width="2" filter="url(#glow)"/>
                        <circle cx="108" cy="45" r="3.5" fill="#00F5D4"/>
                        <g transform="translate(90,70)">
                            <polygon points="0,-15 17,-5 -17,-5" fill="#00F5D4"/>
                            <rect x="-14" y="-5" width="28" height="19" fill="#00F5D4" rx="1"/>
                            <rect x="-4" y="3" width="8" height="11" fill="#060D1A" rx="1"/>
                            <rect x="-11" y="-1" width="7" height="6" fill="#060D1A" rx=".5"/>
                            <rect x="4" y="-1" width="7" height="6" fill="#060D1A" rx=".5"/>
                        </g>
                    </svg>
                </div>
                <h1 class="landing-title">TRAINING PORTAL</h1>
                <p class="landing-subtitle">SMART SECURITY UNIVERSITY ‚Äî QUANTUM CIRCUIT</p>
                <p class="landing-description">Complete learning platform for low-voltage field technicians. Practice quizzes, flashcards, calculators, and an expanding question bank covering electrical fundamentals, NEC codes, fire alarm systems, and security installations.</p>
                <div class="landing-features">
                    <div class="feature-card"><div class="feature-icon">üéØ</div><div class="feature-title">Practice Quizzes</div><div class="feature-desc">Test by level or category</div></div>
                    <div class="feature-card"><div class="feature-icon">üÉè</div><div class="feature-title">Flashcards</div><div class="feature-desc">Quick flip card review</div></div>
                    <div class="feature-card"><div class="feature-icon">üóÉÔ∏è</div><div class="feature-title">Question Bank</div><div class="feature-desc">120+ technical questions</div></div>
                    <div class="feature-card"><div class="feature-icon">üîß</div><div class="feature-title">Calculators</div><div class="feature-desc">Ohm's, VD, Power, Battery</div></div>
                    <div class="feature-card"><div class="feature-icon">üìà</div><div class="feature-title">Progress</div><div class="feature-desc">XP & level tracking</div></div>
                    <div class="feature-card"><div class="feature-icon">üì±</div><div class="feature-title">Mobile Ready</div><div class="feature-desc">Works on any device</div></div>
                </div>
                <div class="landing-cta">
                    <button class="btn-landing btn-primary-q" onclick="showLogin()">üîê Sign In to Train</button>
                    <button class="btn-landing btn-secondary" onclick="showInfoModal()">üìß Request Access</button>
                </div>
            </div>
        </div>
        <footer class="landing-footer"><p style="color:var(--text-muted);font-size:.8rem;font-family:'Rajdhani',sans-serif;letter-spacing:.1em;">SSU QUANTUM CIRCUIT ¬© 2026 ‚Äî SMART SECURITY UNIVERSITY</p></footer>
    </div>
    <!-- LOGIN -->
    <div id="login-page" class="login-page">
        <div class="login-container">
            <div class="login-card">
                <div class="login-header">
                    <div class="login-logo">
                        <svg viewBox="0 0 120 120"><defs><linearGradient id="qG2" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#00F5D4"/><stop offset="50%" style="stop-color:#00BBF9"/><stop offset="100%" style="stop-color:#9B5DE5"/></linearGradient><radialGradient id="sg2" cx="50%" cy="50%" r="50%"><stop offset="0%" style="stop-color:#00BBF9;stop-opacity:.25"/><stop offset="100%" style="stop-color:#9B5DE5;stop-opacity:0"/></radialGradient></defs><circle cx="60" cy="55" r="35" fill="url(#sg2)"/><circle cx="60" cy="55" r="28" fill="#060D1A" stroke="url(#qG2)" stroke-width="2.5"/><g transform="translate(60,60)"><polygon points="0,-14 16,-4 -16,-4" fill="#00F5D4"/><rect x="-13" y="-4" width="26" height="18" fill="#00F5D4" rx="1"/><rect x="-4" y="3" width="8" height="11" fill="#060D1A" rx="1"/></g></svg>
                    </div>
                    <h2 class="login-title">SIGN IN</h2>
                    <p class="login-subtitle">SSU Training Portal</p>
                </div>
                <div class="login-form">
                    <div class="form-group"><label class="form-label">Employee ID</label><input type="text" class="form-input" id="login-employee-id" placeholder="Enter your ID"></div>
                    <div class="form-group"><label class="form-label">Full Name</label><input type="text" class="form-input" id="login-name" placeholder="First Last"></div>
                    <div class="form-group"><label class="form-label">Password</label><div class="form-input-wrapper"><input type="password" class="form-input has-icon" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"><button class="password-toggle" onclick="togglePassword('login-password',this)">üëÅÔ∏è</button></div></div>
                    <div class="form-row"><label class="remember-me"><input type="checkbox" id="remember-me"><span>Remember me</span></label><a href="#" class="forgot-link" onclick="showForgotModal();return false;">Forgot password?</a></div>
                    <div id="login-error" class="login-error"></div>
                    <button class="login-btn" onclick="handleLogin()">ENTER TRAINING ‚Üí</button>
                </div>
                <div class="login-footer-wrap"><p class="login-footer-text">SSU Quantum Circuit ¬© 2026</p><a href="#" class="back-link" onclick="showLanding();return false;">‚Üê Back to landing</a></div>
            </div>
        </div>
    </div>
    <!-- MODALS -->
    <div id="forgot-modal" class="modal-overlay"><div class="modal-card"><div class="modal-header"><div class="modal-icon">üîë</div><div class="modal-title">Reset Password</div><div class="modal-desc">Contact your supervisor or training admin.</div></div><div id="forgot-form-section"><div class="modal-actions"><button class="modal-btn modal-btn-cancel" onclick="closeForgotModal()">Close</button></div></div><div id="forgot-success" class="modal-success"><p>‚úÖ Contact admin for password reset.</p></div></div></div>
    <div id="info-modal" class="modal-overlay"><div class="modal-card"><div class="modal-header"><div class="modal-icon">üìß</div><div class="modal-title">Request Access</div><div class="modal-desc">Contact your training administrator for portal access credentials.</div></div><div id="info-form-section"><div class="modal-actions"><button class="modal-btn modal-btn-cancel" onclick="closeInfoModal()">Close</button></div></div><div id="info-success" class="modal-success"><p>‚úÖ Request noted.</p></div></div></div>
    <!-- APP -->
    <div id="app-wrapper" class="app-wrapper">
        <header class="header"><div class="header-content">
            <div class="logo-section">
                <div class="logo-icon"><svg viewBox="0 0 120 120"><defs><linearGradient id="qG3" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#00F5D4"/><stop offset="100%" style="stop-color:#9B5DE5"/></linearGradient><radialGradient id="sg3" cx="50%" cy="50%" r="50%"><stop offset="0%" style="stop-color:#00BBF9;stop-opacity:.2"/><stop offset="100%" style="stop-color:transparent"/></radialGradient></defs><circle cx="60" cy="55" r="30" fill="url(#sg3)"/><circle cx="60" cy="55" r="24" fill="#060D1A" stroke="url(#qG3)" stroke-width="2"/><g transform="translate(60,60)"><polygon points="0,-12 14,-3 -14,-3" fill="#00F5D4"/><rect x="-11" y="-3" width="22" height="15" fill="#00F5D4" rx="1"/><rect x="-3" y="2" width="6" height="10" fill="#060D1A" rx=".5"/></g></svg></div>
                <div class="brand"><h1>SSU TRAINING</h1><span class="tagline">QUANTUM CIRCUIT ‚Ä¢ SMART SECURITY UNIVERSITY</span></div>
            </div>
            <div class="user-section">
                <div class="stat-badges"><div class="stat-badge">‚ö° <span class="value" id="statXP">0</span> XP</div><div class="stat-badge">üî• <span class="value" id="statStreak">0</span></div><div class="stat-badge">üìä <span class="value" id="statSessions">0</span></div></div>
                <div class="user-info"><div class="user-details"><div class="user-name" id="userName">Technician</div><div class="user-level" id="userLevel">FUNDAMENTALS</div></div><div class="user-avatar" id="userAvatar">T</div></div>
                <button class="logout-btn" onclick="logout()">‚èª Logout</button>
            </div>
        </div></header>
        <nav class="nav-tabs">
            <div class="nav-tab active" data-section="dashboard" onclick="showSection('dashboard')">üìä Dashboard</div>
            <div class="nav-tab" data-section="quiz" onclick="showSection('quiz')">üéØ Quiz</div>
            <div class="nav-tab" data-section="flashcards" onclick="showSection('flashcards')">üÉè Cards</div>
            <div class="nav-tab" data-section="questionbank" onclick="showSection('questionbank')">üóÉÔ∏è Bank</div>
            <div class="nav-tab" data-section="calculators" onclick="showSection('calculators')">üîß Calcs</div>
            <div class="nav-tab" data-section="progress" onclick="showSection('progress')">üìà Progress</div>
        </nav>
        <main>
            <!-- DASHBOARD -->
            <section id="section-dashboard" class="app-section active">
                <div class="section-title">‚ö° CERTIFICATION LEVELS</div>
                <div class="level-grid">
                    <div class="level-card" onclick="startLevelQuiz('FUND')"><div class="level-name" style="color:var(--level-fund)">FND</div><div class="level-desc">Fundamentals</div><div class="level-status">15 Questions</div></div>
                    <div class="level-card" onclick="startLevelQuiz('L1')"><div class="level-name" style="color:var(--level-1)">L1</div><div class="level-desc">Entry</div><div class="level-status">12 Questions</div></div>
                    <div class="level-card" onclick="startLevelQuiz('L2')"><div class="level-name" style="color:var(--level-2)">L2</div><div class="level-desc">Intermediate</div><div class="level-status">13 Questions</div></div>
                    <div class="level-card" onclick="startLevelQuiz('L3')"><div class="level-name" style="color:var(--level-3)">L3</div><div class="level-desc">Advanced</div><div class="level-status">13 Questions</div></div>
                    <div class="level-card" onclick="startLevelQuiz('L4')"><div class="level-name" style="color:var(--level-4)">L4</div><div class="level-desc">Specialist</div><div class="level-status">12 Questions</div></div>
                    <div class="level-card" onclick="startLevelQuiz('NEC')"><div class="level-name" style="color:#f59e0b">NEC</div><div class="level-desc">Code Articles</div><div class="level-status">20 Questions</div></div>
                    <div class="level-card" onclick="startLevelQuiz('FIRE')"><div class="level-name" style="color:#ef4444">FIRE</div><div class="level-desc">Fire Alarm</div><div class="level-status">15 Questions</div></div>
                    <div class="level-card" onclick="startLevelQuiz('VD')"><div class="level-name" style="color:#06b6d4">VD</div><div class="level-desc">Voltage Drop</div><div class="level-status">10 Questions</div></div>
                </div>
                <div class="section-title">‚ö° QUICK START ‚Äî BY CATEGORY</div>
                <div class="category-grid">
                    <div class="category-card" onclick="startCategoryQuiz('Safety')"><div class="category-icon">ü¶∫</div><div class="category-name">Safety</div><div class="category-count" id="catSafety">--</div></div>
                    <div class="category-card" onclick="startCategoryQuiz('Electrical')"><div class="category-icon">‚ö°</div><div class="category-name">Electrical</div><div class="category-count" id="catElectrical">--</div></div>
                    <div class="category-card" onclick="startCategoryQuiz('Security')"><div class="category-icon">üîê</div><div class="category-name">Security</div><div class="category-count" id="catSecurity">--</div></div>
                    <div class="category-card" onclick="startCategoryQuiz('Fire')"><div class="category-icon">üî•</div><div class="category-name">Fire Alarm</div><div class="category-count" id="catFire">--</div></div>
                    <div class="category-card" onclick="startCategoryQuiz('NEC')"><div class="category-icon">üìñ</div><div class="category-name">NEC Codes</div><div class="category-count" id="catNEC">--</div></div>
                    <div class="category-card" onclick="startCategoryQuiz('Wiring')"><div class="category-icon">üîå</div><div class="category-name">Wiring</div><div class="category-count" id="catWiring">--</div></div>
                    <div class="category-card" onclick="startCategoryQuiz('Tools')"><div class="category-icon">üîß</div><div class="category-name">Tools</div><div class="category-count" id="catTools">--</div></div>
                    <div class="category-card" onclick="startCategoryQuiz('all')"><div class="category-icon">üìö</div><div class="category-name">All Topics</div><div class="category-count" id="catAll">--</div></div>
                </div>
            </section>
            <!-- QUIZ -->
            <section id="section-quiz" class="app-section">
                <div id="quiz-active" class="hidden">
                    <div class="quiz-header"><div class="quiz-progress"><span class="progress-text" id="quizProgress">Question 1 of 10</span><div class="progress-bar"><div class="progress-fill" id="quizProgressBar" style="width:0%"></div></div></div><div class="quiz-score" id="quizScore">‚úì 0 | ‚úó 0</div></div>
                    <div id="quizQuestionContainer"></div>
                    <div class="btn-group" style="justify-content:space-between;"><button class="btn btn-sec" onclick="endQuiz()">‚Üê Exit Quiz</button><button class="btn btn-primary hidden" id="quizNextBtn" onclick="nextQuizQuestion()">Next ‚Üí</button></div>
                </div>
                <div id="quiz-results" class="hidden">
                    <div class="results-card"><div class="results-icon" id="quizResultsIcon">üéØ</div><h2 class="results-title" id="quizResultsTitle">Quiz Complete!</h2><div class="results-score" id="quizFinalScore">0%</div><div class="results-breakdown"><div class="results-stat"><div class="results-stat-value" style="color:var(--accent-green)" id="quizCorrect">0</div><div class="results-stat-label">Correct</div></div><div class="results-stat"><div class="results-stat-value" style="color:var(--accent-red)" id="quizIncorrect">0</div><div class="results-stat-label">Incorrect</div></div><div class="results-stat"><div class="results-stat-value" style="color:var(--accent-cyan)" id="quizXPEarned">0</div><div class="results-stat-label">XP Earned</div></div></div><div class="btn-group" style="justify-content:center;margin-top:1.5rem;"><button class="btn btn-sec" onclick="endQuiz()">Back to Dashboard</button><button class="btn btn-primary" onclick="retakeQuiz()">üîÑ Retake</button></div></div>
                </div>
                <div id="quiz-setup">
                    <div class="section-title">üéØ SELECT QUIZ</div>
                    <div class="category-grid">
                        <div class="category-card" onclick="startCategoryQuiz('all')"><div class="category-icon">üìö</div><div class="category-name">All Topics</div><div class="category-count">10 random</div></div>
                        <div class="category-card" onclick="startCategoryQuiz('Safety')"><div class="category-icon">ü¶∫</div><div class="category-name">Safety</div><div class="category-count">Safety focused</div></div>
                        <div class="category-card" onclick="startCategoryQuiz('Electrical')"><div class="category-icon">‚ö°</div><div class="category-name">Electrical</div><div class="category-count">Circuits & Power</div></div>
                        <div class="category-card" onclick="startCategoryQuiz('Security')"><div class="category-icon">üîê</div><div class="category-name">Security</div><div class="category-count">Systems</div></div>
                        <div class="category-card" onclick="startCategoryQuiz('Fire')"><div class="category-icon">üî•</div><div class="category-name">Fire Alarm</div><div class="category-count">NFPA/NICET</div></div>
                        <div class="category-card" onclick="startCategoryQuiz('NEC')"><div class="category-icon">üìñ</div><div class="category-name">NEC</div><div class="category-count">Code Articles</div></div>
                    </div>
                </div>
            </section>
            <!-- FLASHCARDS -->
            <section id="section-flashcards" class="app-section">
                <div id="flashcard-active" class="hidden"><div class="flashcard-container"><div class="flashcard-progress" id="flashcardProgress">Card 1 of 10</div><div class="flashcard" id="flashcard" onclick="flipCard()"><div class="flashcard-inner"><div class="flashcard-front"><div class="flashcard-label">QUESTION</div><div class="flashcard-content" id="flashcardQuestion">Loading...</div><div class="flashcard-hint">Tap to reveal answer</div></div><div class="flashcard-back"><div class="flashcard-label">ANSWER</div><div class="flashcard-content" id="flashcardAnswer">Loading...</div></div></div></div><div class="flashcard-controls"><button class="flashcard-btn incorrect" onclick="markCard(false)">‚úó Review</button><button class="flashcard-btn" onclick="nextFlashcard()">Skip ‚Üí</button><button class="flashcard-btn correct" onclick="markCard(true)">‚úì Got It</button></div><div style="text-align:center;margin-top:1.5rem;"><button class="btn btn-sec" onclick="endFlashcards()">‚Üê Exit</button></div></div></div>
                <div id="flashcard-setup"><div class="section-title">üÉè FLASHCARD STUDY</div><div class="category-grid">
                    <div class="category-card" onclick="startFlashcards('all')"><div class="category-icon">üìö</div><div class="category-name">All</div><div class="category-count">Random review</div></div>
                    <div class="category-card" onclick="startFlashcards('Safety')"><div class="category-icon">ü¶∫</div><div class="category-name">Safety</div><div class="category-count">Safety cards</div></div>
                    <div class="category-card" onclick="startFlashcards('Electrical')"><div class="category-icon">‚ö°</div><div class="category-name">Electrical</div><div class="category-count">Circuits</div></div>
                    <div class="category-card" onclick="startFlashcards('Security')"><div class="category-icon">üîê</div><div class="category-name">Security</div><div class="category-count">Systems</div></div>
                    <div class="category-card" onclick="startFlashcards('Fire')"><div class="category-icon">üî•</div><div class="category-name">Fire</div><div class="category-count">FA cards</div></div>
                    <div class="category-card" onclick="startFlashcards('NEC')"><div class="category-icon">üìñ</div><div class="category-name">NEC</div><div class="category-count">Code cards</div></div>
                </div></div>
            </section>
            <!-- QUESTION BANK -->
            <section id="section-questionbank" class="app-section">
                <div class="qbank-header"><h2 class="section-title">üóÉÔ∏è QUESTION BANK</h2><div class="search-box"><span>üîç</span><input type="text" id="questionSearch" placeholder="Search questions..." oninput="filterQuestions()"></div></div>
                <div class="filter-row">
                    <button class="filter-btn active" data-filter="all" onclick="setFilter('all')">All</button>
                    <button class="filter-btn" data-filter="FUND" onclick="setFilter('FUND')">Fundamentals</button>
                    <button class="filter-btn" data-filter="L1" onclick="setFilter('L1')">Level 1</button>
                    <button class="filter-btn" data-filter="L2" onclick="setFilter('L2')">Level 2</button>
                    <button class="filter-btn" data-filter="L3" onclick="setFilter('L3')">Level 3</button>
                    <button class="filter-btn" data-filter="L4" onclick="setFilter('L4')">Level 4</button>
                    <button class="filter-btn" data-filter="NEC" onclick="setFilter('NEC')">NEC</button>
                    <button class="filter-btn" data-filter="FIRE" onclick="setFilter('FIRE')">Fire Alarm</button>
                    <button class="filter-btn" data-filter="VD" onclick="setFilter('VD')">Voltage Drop</button>
                </div>
                <div class="question-list" id="questionList"></div>
            </section>
            <!-- CALCULATORS -->
            <section id="section-calculators" class="app-section">
                <div class="section-title">üîß FIELD CALCULATORS</div>
                <div class="calc-grid">
                    <div class="calc-card"><h3>‚ö° OHM'S LAW</h3><div class="calc-formula">V = I √ó R &nbsp;|&nbsp; I = V / R &nbsp;|&nbsp; R = V / I</div><div class="calc-row"><label>Voltage (V):</label><input type="number" id="ohmsV" placeholder="Volts" step="any"></div><div class="calc-row"><label>Current (A):</label><input type="number" id="ohmsI" placeholder="Amps" step="any"></div><div class="calc-row"><label>Resistance (Œ©):</label><input type="number" id="ohmsR" placeholder="Ohms" step="any"></div><button class="calc-btn" onclick="calcOhms()">CALCULATE</button><div class="calc-result" id="ohmsResult">Enter any 2 values, leave 1 blank</div></div>
                    <div class="calc-card"><h3>üìê VOLTAGE DROP</h3><div class="calc-formula">VD = (2 √ó K √ó I √ó D) / CM</div><div class="calc-row"><label>Voltage:</label><select id="vdVoltage"><option value="12">12V DC</option><option value="24">24V DC</option><option value="48">48V DC</option><option value="120">120V AC</option></select></div><div class="calc-row"><label>Current (A):</label><input type="number" id="vdAmps" value="2" min="0.1" step="0.1"></div><div class="calc-row"><label>Wire AWG:</label><select id="vdWire"><option value="22">22 AWG</option><option value="20">20 AWG</option><option value="18" selected>18 AWG</option><option value="16">16 AWG</option><option value="14">14 AWG</option><option value="12">12 AWG</option><option value="10">10 AWG</option><option value="8">8 AWG</option></select></div><div class="calc-row"><label>Distance (ft):</label><input type="number" id="vdDistance" value="100" min="1"></div><div class="calc-row"><label>Conductor:</label><select id="vdMaterial"><option value="12.9">Copper (K=12.9)</option><option value="21.2">Aluminum (K=21.2)</option></select></div><button class="calc-btn" onclick="calcVD()">CALCULATE</button><div class="calc-result" id="vdResult">Enter values and calculate</div></div>
                    <div class="calc-card"><h3>üí° POWER</h3><div class="calc-formula">P = V √ó I &nbsp;|&nbsp; P = I¬≤R &nbsp;|&nbsp; P = V¬≤/R</div><div class="calc-row"><label>Voltage (V):</label><input type="number" id="pwrV" placeholder="Volts" step="any"></div><div class="calc-row"><label>Current (A):</label><input type="number" id="pwrI" placeholder="Amps" step="any"></div><div class="calc-row"><label>Resistance (Œ©):</label><input type="number" id="pwrR" placeholder="Ohms" step="any"></div><button class="calc-btn" onclick="calcPower()">CALCULATE</button><div class="calc-result" id="pwrResult">Enter any 2 values</div></div>
                    <div class="calc-card"><h3>üîã BATTERY STANDBY</h3><div class="calc-formula">Hours = Ah / Load &nbsp;|&nbsp; Wh = Ah √ó V</div><div class="calc-row"><label>Battery (Ah):</label><input type="number" id="batAh" value="7" min="0.1" step="0.1"></div><div class="calc-row"><label>Voltage (V):</label><select id="batV"><option value="12">12V</option><option value="24">24V</option><option value="6">6V</option></select></div><div class="calc-row"><label>Load (A):</label><input type="number" id="batLoad" value="0.5" min="0.01" step="0.01"></div><div class="calc-row"><label>Derating:</label><select id="batDerate"><option value="1">None (100%)</option><option value="0.8" selected>Standard (80%)</option><option value="0.6">Conservative (60%)</option></select></div><button class="calc-btn" onclick="calcBattery()">CALCULATE</button><div class="calc-result" id="batResult">Enter values and calculate</div></div>
                </div>
            </section>
            <!-- PROGRESS -->
            <section id="section-progress" class="app-section">
                <h2 class="section-title">üìà YOUR PROGRESS</h2>
                <div class="dashboard-grid">
                    <div class="progress-card"><div class="progress-card-title">Level Performance</div>
                        <div class="progress-row"><span class="progress-label">Fundamentals</span><span class="progress-value" id="progFund">0%</span></div>
                        <div class="progress-row"><span class="progress-label">Level 1</span><span class="progress-value" id="progL1">0%</span></div>
                        <div class="progress-row"><span class="progress-label">Level 2</span><span class="progress-value" id="progL2">0%</span></div>
                        <div class="progress-row"><span class="progress-label">Level 3</span><span class="progress-value" id="progL3">0%</span></div>
                        <div class="progress-row"><span class="progress-label">Level 4</span><span class="progress-value" id="progL4">0%</span></div>
                        <div class="progress-row"><span class="progress-label">NEC</span><span class="progress-value" id="progNEC">0%</span></div>
                        <div class="progress-row"><span class="progress-label">Fire Alarm</span><span class="progress-value" id="progFIRE">0%</span></div>
                        <div class="progress-row"><span class="progress-label">Voltage Drop</span><span class="progress-value" id="progVD">0%</span></div>
                    </div>
                    <div class="progress-card"><div class="progress-card-title">XP Requirements</div>
                        <div class="progress-row"><span class="progress-label">L1 ‚Üí L2</span><span class="progress-value">500 XP</span></div>
                        <div class="progress-row"><span class="progress-label">L2 ‚Üí L3</span><span class="progress-value">1500 XP</span></div>
                        <div class="progress-row"><span class="progress-label">L3 ‚Üí L4</span><span class="progress-value">3000 XP</span></div>
                        <div class="progress-row"><span class="progress-label">L4 ‚Üí Master</span><span class="progress-value">5000 XP</span></div>
                    </div>
                </div>
                <div class="btn-group" style="margin-top:1.5rem;"><button class="btn btn-sec" onclick="exportData()">üì§ Export Data</button><button class="btn btn-sec" onclick="resetData()">üîÑ Reset Progress</button></div>
            </section>
        </main>
    </div>

    <script>
        // ==========================================
        // QUESTION DATABASE ‚Äî ALL FUNDAMENTALS, NO COMPANY ONBOARDING
        // 120 questions: electrical, low-voltage, NEC, fire alarm, security, safety
        // ==========================================
        const questionDatabase = [
            // FUNDAMENTALS (15) ‚Äî Real electrical/industry basics
            {id:"F-001",level:"FUND",levelName:"Fundamentals",category:"Electrical",question:"What is voltage?",options:["Flow of electrons","Electrical potential difference measured in Volts","Opposition to current flow","Power consumed"],correct:1,explanation:"Voltage (V) is the electrical potential difference, the 'pressure' pushing electrons through a circuit."},
            {id:"F-002",level:"FUND",levelName:"Fundamentals",category:"Electrical",question:"What is current?",options:["Resistance in a wire","Electrical potential","Flow of electrons measured in Amperes","Power output"],correct:2,explanation:"Current (I) is the flow of electrons through a conductor, measured in Amps."},
            {id:"F-003",level:"FUND",levelName:"Fundamentals",category:"Electrical",question:"What is resistance?",options:["Voltage times current","Opposition to current flow measured in Ohms","Electron speed","Wire color"],correct:1,explanation:"Resistance (R) opposes current flow and is measured in Ohms (Œ©)."},
            {id:"F-004",level:"FUND",levelName:"Fundamentals",category:"Electrical",question:"What is the difference between AC and DC?",options:["AC is faster","AC alternates direction, DC flows one direction","DC is more dangerous","No difference"],correct:1,explanation:"AC (Alternating Current) reverses direction periodically. DC (Direct Current) flows one direction. Security systems typically use DC."},
            {id:"F-005",level:"FUND",levelName:"Fundamentals",category:"Industry",question:"What does 'low-voltage' typically refer to?",options:["Under 10V","Under 50V","Under 120V","Under 240V"],correct:1,explanation:"Low-voltage = under 50 volts. Security/fire alarm systems run at 12-24 VDC."},
            {id:"F-006",level:"FUND",levelName:"Fundamentals",category:"Tools",question:"What tool measures voltage, current, and resistance?",options:["Cable tester","Multimeter","Punch down tool","PoE injector"],correct:1,explanation:"A multimeter is the essential field tool for measuring voltage, current, and resistance."},
            {id:"F-007",level:"FUND",levelName:"Fundamentals",category:"Electrical",question:"What is Ohm's Law?",options:["V = I √ó R","V = I + R","P = V √ó I","V = I / R"],correct:0,explanation:"Ohm's Law: V = I √ó R. Voltage equals Current times Resistance. Memorize this."},
            {id:"F-008",level:"FUND",levelName:"Fundamentals",category:"Wiring",question:"In wire gauge (AWG), a larger number means what?",options:["Thicker wire","Thinner wire","More insulation","Higher voltage rating"],correct:1,explanation:"AWG is inverse: 22 AWG is thinner than 14 AWG. Smaller number = bigger wire."},
            {id:"F-009",level:"FUND",levelName:"Fundamentals",category:"Safety",question:"What is the '4-to-1 rule' for ladder safety?",options:["Breaks every 4 hours","Base 1ft out per 4ft height","4 people per ladder","4 tools max"],correct:1,explanation:"4-to-1: base 1 foot from wall for every 4 feet of ladder height."},
            {id:"F-010",level:"FUND",levelName:"Fundamentals",category:"Safety",question:"Before working on electrical circuits, you should?",options:["Put on gloves","Verify de-energized with voltage tester","Notify homeowner","Check weather"],correct:1,explanation:"ALWAYS verify circuits are de-energized with a voltage tester. Never assume."},
            {id:"F-011",level:"FUND",levelName:"Fundamentals",category:"Electrical",question:"What color wire is ground in US wiring?",options:["Black","White","Green or bare copper","Red"],correct:2,explanation:"Green or bare copper = ground. Black = hot, white = neutral, red = second hot."},
            {id:"F-012",level:"FUND",levelName:"Fundamentals",category:"Electrical",question:"What does AWG stand for?",options:["American Wire Gauge","Alternating Wire Grade","Applied Wattage Guide","American Wiring Group"],correct:0,explanation:"AWG = American Wire Gauge ‚Äî the standard wire sizing system in the US."},
            {id:"F-013",level:"FUND",levelName:"Fundamentals",category:"Electrical",question:"In a series circuit, total resistance equals?",options:["Lowest resistor value","R1 + R2 + R3...","1/(1/R1 + 1/R2)","Average of all resistors"],correct:1,explanation:"Series: add all resistances. Two 10Œ© in series = 20Œ© total."},
            {id:"F-014",level:"FUND",levelName:"Fundamentals",category:"Electrical",question:"Two 10Œ© resistors in parallel equals?",options:["20Œ©","10Œ©","5Œ©","2.5Œ©"],correct:2,explanation:"Equal parallel: R/n. Two 10Œ© in parallel = 10/2 = 5Œ©."},
            {id:"F-015",level:"FUND",levelName:"Fundamentals",category:"Safety",question:"What PPE is required when drilling into walls?",options:["Gloves only","Safety glasses and hearing protection","Hard hat only","No PPE needed"],correct:1,explanation:"Safety glasses protect from debris; hearing protection for power tool noise."},

            // LEVEL 1 (12) ‚Äî Entry level technical
            {id:"L1-001",level:"L1",levelName:"Level 1",category:"Safety",question:"What is the '3-point contact' rule on ladders?",options:["3 tools within reach","2 hands + 1 foot OR 2 feet + 1 hand","Teams of 3","Breaks every 3 hours"],correct:1,explanation:"3-point contact: always maintain 2 hands + 1 foot or 2 feet + 1 hand."},
            {id:"L1-002",level:"L1",levelName:"Level 1",category:"Electrical",question:"Using Ohm's Law: 24V circuit with 12Œ© resistance draws how much current?",options:["0.5A","1A","2A","12A"],correct:2,explanation:"I = V/R = 24/12 = 2 Amps."},
            {id:"L1-003",level:"L1",levelName:"Level 1",category:"Security",question:"Primary function of a door/window contact sensor?",options:["Detect motion","Detect when door/window opens","Detect glass break","Detect smoke"],correct:1,explanation:"Contact sensors use a magnetic reed switch to detect door/window opening."},
            {id:"L1-004",level:"L1",levelName:"Level 1",category:"Security",question:"What does 'NC' mean in alarm terminology?",options:["No Connection","Normally Closed","Network Control","Non-Compatible"],correct:1,explanation:"NC = Normally Closed. Circuit is complete at rest, opens when triggered."},
            {id:"L1-005",level:"L1",levelName:"Level 1",category:"Safety",question:"Before working in an attic, you should?",options:["Just start","Assess hazards, ensure lighting/ventilation","Check electricity only","Wait for approval"],correct:1,explanation:"Assess hazards, ensure proper lighting, ventilation, and wear appropriate PPE."},
            {id:"L1-006",level:"L1",levelName:"Level 1",category:"Tools",question:"What is a punch down tool used for?",options:["Measuring voltage","Terminating wires into patch panels","Testing cables","Powering IP devices"],correct:1,explanation:"Punch down tools terminate wires into patch panels and keystone jacks."},
            {id:"L1-007",level:"L1",levelName:"Level 1",category:"Security",question:"Typical voltage for residential alarm panels?",options:["5 VDC","12 VDC","24 VAC","48 VDC"],correct:1,explanation:"Most residential security panels run on 12 VDC with battery backup."},
            {id:"L1-008",level:"L1",levelName:"Level 1",category:"Safety",question:"Who is responsible for workplace safety?",options:["Safety department","Managers only","Everyone","OSHA"],correct:2,explanation:"Safety is everyone's shared responsibility ‚Äî period."},
            {id:"L1-009",level:"L1",levelName:"Level 1",category:"Electrical",question:"What is the power formula?",options:["P = V √ó I","P = V / I","P = I / R","P = V + I"],correct:0,explanation:"Power (Watts) = Voltage √ó Current. P = V √ó I."},
            {id:"L1-010",level:"L1",levelName:"Level 1",category:"Electrical",question:"Calculate: 24V √ó 2A = ?",options:["12W","24W","48W","96W"],correct:2,explanation:"P = V √ó I = 24 √ó 2 = 48 Watts."},
            {id:"L1-011",level:"L1",levelName:"Level 1",category:"Wiring",question:"Standard wire gauge for alarm sensor loops?",options:["22 AWG","18 AWG","14 AWG","10 AWG"],correct:0,explanation:"22 AWG is standard for alarm sensor loops (contacts, motion detectors)."},
            {id:"L1-012",level:"L1",levelName:"Level 1",category:"Wiring",question:"What is the purpose of an EOL resistor?",options:["Increase signal strength","Supervise the wiring loop for cuts or shorts","Filter noise","Boost power"],correct:1,explanation:"EOL (End of Line) resistors let the panel supervise the circuit for faults."},

            // LEVEL 2 (13) ‚Äî Intermediate
            {id:"L2-001",level:"L2",levelName:"Level 2",category:"Fire Alarm",question:"What is the primary purpose of a FACP?",options:["Backup power","Receive signals and activate notification appliances","Extinguish fires","Notify insurance"],correct:1,explanation:"Fire Alarm Control Panel receives signals from detectors and activates horns/strobes."},
            {id:"L2-002",level:"L2",levelName:"Level 2",category:"Fire Alarm",question:"What does EOL stand for in fire alarm systems?",options:["End of Life","End of Line","Electronic Output Level","Emergency Override"],correct:1,explanation:"EOL = End of Line resistors, placed at circuit end to supervise wiring."},
            {id:"L2-003",level:"L2",levelName:"Level 2",category:"Fire Alarm",question:"Standard EOL resistor value?",options:["1K ohm","2.2K ohm","4.7K ohm","10K ohm"],correct:2,explanation:"4.7K ohm is the most common EOL value. Always verify with panel specs."},
            {id:"L2-004",level:"L2",levelName:"Level 2",category:"NEC",question:"Max voltage drop for fire alarm circuits per NFPA 72?",options:["5%","10%","15%","20%"],correct:1,explanation:"NFPA 72 allows maximum 10% voltage drop on fire alarm circuits."},
            {id:"L2-005",level:"L2",levelName:"Level 2",category:"Security",question:"Difference between PIR and dual-tech motion detectors?",options:["PIR = heat only, dual-tech = PIR + microwave","Same thing","Dual-tech outdoor only","PIR pets only"],correct:0,explanation:"PIR detects heat. Dual-tech combines PIR + microwave for fewer false alarms."},
            {id:"L2-006",level:"L2",levelName:"Level 2",category:"Safety",question:"What if you discover asbestos?",options:["Continue carefully","Stop immediately, notify appropriate parties","Cover with tape","Remove it yourself"],correct:1,explanation:"STOP work immediately. Asbestos requires licensed abatement professionals."},
            {id:"L2-007",level:"L2",levelName:"Level 2",category:"Safety",question:"What is lockout/tagout for?",options:["Prevent theft","Ensure energy sources stay de-energized during service","Track hours","Secure building"],correct:1,explanation:"LOTO ensures hazardous energy is isolated during maintenance work."},
            {id:"L2-008",level:"L2",levelName:"Level 2",category:"Wireless",question:"Typical supervision interval for wireless sensors?",options:["Every second","Every 30-60 minutes","Once per day","Only when triggered"],correct:1,explanation:"Wireless sensors check in every 30-60 minutes to confirm communication."},
            {id:"L2-009",level:"L2",levelName:"Level 2",category:"Wiring",question:"What gauge wire for residential security panel power?",options:["22 AWG","18 AWG","14 AWG","10 AWG"],correct:1,explanation:"18 AWG is standard for residential security panel power runs."},
            {id:"L2-010",level:"L2",levelName:"Level 2",category:"Fire Alarm",question:"What smoke detector type uses a radioactive source?",options:["Photoelectric","Ionization","Beam detector","Duct detector"],correct:1,explanation:"Ionization detectors use Americium-241 to detect fast-burning fires."},
            {id:"L2-011",level:"L2",levelName:"Level 2",category:"Security",question:"What are 'zones' in a security system?",options:["Geographic areas","Input circuits grouping sensors","Warranty periods","Service regions"],correct:1,explanation:"Zones are input circuits that group sensors for identification and control."},
            {id:"L2-012",level:"L2",levelName:"Level 2",category:"Safety",question:"In summer attics, most critical hazard?",options:["Rain","Heat stress, dehydration, unstable footing","Flooding","High winds"],correct:1,explanation:"Attics in summer = extreme heat risk. Hydrate, take breaks, watch your footing."},
            {id:"L2-013",level:"L2",levelName:"Level 2",category:"Electrical",question:"1 horsepower equals how many watts?",options:["500W","746W","1000W","1500W"],correct:1,explanation:"1 HP = 746 Watts. Standard conversion factor."},

            // LEVEL 3 (13) ‚Äî Advanced
            {id:"L3-001",level:"L3",levelName:"Level 3",category:"NFPA 72",question:"Max smoke detector spacing on flat ceilings per NFPA 72?",options:["20 feet","30 feet","40 feet","50 feet"],correct:1,explanation:"NFPA 72: max 30 feet spacing on smooth, flat ceilings."},
            {id:"L3-002",level:"L3",levelName:"Level 3",category:"NEC",question:"NEC requirement for GFCI in bathrooms?",options:["Not required","Within 6ft of sink","All outlets must be GFCI protected","Only near bathtub"],correct:2,explanation:"NEC requires all 125V, 15/20A bathroom receptacles be GFCI protected."},
            {id:"L3-003",level:"L3",levelName:"Level 3",category:"Network",question:"Maximum Cat5e cable run without degradation?",options:["50 meters","100 meters","150 meters","200 meters"],correct:1,explanation:"Cat5e max run: 100 meters (328 feet) without repeaters."},
            {id:"L3-004",level:"L3",levelName:"Level 3",category:"Fire Alarm",question:"Difference between conventional and addressable fire systems?",options:["Cost only","Conventional = zone, addressable = specific device","No difference","Addressable = wireless"],correct:1,explanation:"Conventional shows zone; addressable identifies exact device location."},
            {id:"L3-005",level:"L3",levelName:"Level 3",category:"Network",question:"What is PoE?",options:["Power over Ethernet","Protection of Equipment","Panel Operating Environment","Programmable Output"],correct:0,explanation:"PoE = Power over Ethernet. Delivers power and data through single cable."},
            {id:"L3-006",level:"L3",levelName:"Level 3",category:"Safety",question:"Min safe distance from overhead power lines (non-qualified)?",options:["5 feet","10 feet","20 feet","50 feet"],correct:1,explanation:"OSHA: at least 10 feet from overhead power lines up to 50kV."},
            {id:"L3-007",level:"L3",levelName:"Level 3",category:"Security",question:"What is video analytics used for?",options:["Better video quality","Auto-detect events like motion/intrusion","Compress files","Social media"],correct:1,explanation:"Video analytics auto-detect events: motion, intrusion, abandoned objects."},
            {id:"L3-008",level:"L3",levelName:"Level 3",category:"Fire Alarm",question:"Purpose of fire alarm annunciator panel?",options:["Sound alarm","Remote status display at building entrances","Control sprinklers","Generate reports"],correct:1,explanation:"Annunciators provide remote status display for fire department use at entries."},
            {id:"L3-009",level:"L3",levelName:"Level 3",category:"Electrical",question:"Purpose of isolation transformer?",options:["Increase voltage","Electrically isolate equipment and reduce noise","Decrease current","AC to DC"],correct:1,explanation:"Isolation transformers provide electrical isolation and reduce EMI noise."},
            {id:"L3-010",level:"L3",levelName:"Level 3",category:"Security",question:"False alarm reduction technology includes?",options:["Cheaper sensors","Cross-zoning, verification, intelligent algorithms","Fewer sensors","Louder sirens"],correct:1,explanation:"Modern panels use cross-zoning, verification delays, and intelligent detection."},
            {id:"L3-011",level:"L3",levelName:"Level 3",category:"Safety",question:"Proper procedure after electrical shock?",options:["Continue after resting","Seek medical evaluation even if you feel fine","Apply ice","Drink water"],correct:1,explanation:"ALL electrical shocks require medical evaluation. Internal injuries may not be apparent."},
            {id:"L3-012",level:"L3",levelName:"Level 3",category:"Fire Alarm",question:"What triggers a waterflow switch?",options:["Heat only","Smoke only","Water movement in pipes","Manual activation"],correct:2,explanation:"Waterflow switches detect water movement when sprinkler heads activate."},
            {id:"L3-013",level:"L3",levelName:"Level 3",category:"Wireless",question:"Benefit of encrypted wireless sensors?",options:["Longer range","Prevents signal interception/replay attacks","Better battery","Cheaper"],correct:1,explanation:"Encryption prevents signal capture, replay attacks, and jamming."},

            // LEVEL 4 (12) ‚Äî Specialist
            {id:"L4-001",level:"L4",levelName:"Level 4",category:"NFPA 72",question:"Per NFPA 72, what's required in elevator lobbies?",options:["Heat detectors only","Smoke detectors with elevator recall","No detection","CO detectors"],correct:1,explanation:"NFPA 72 requires smoke detectors with elevator recall capability."},
            {id:"L4-002",level:"L4",levelName:"Level 4",category:"Fire Alarm",question:"What does SLC stand for in fire alarms?",options:["Standard Line Connection","Signaling Line Circuit","Secondary Loop Controller","Safety Level Certification"],correct:1,explanation:"SLC = Signaling Line Circuit for addressable device communication."},
            {id:"L4-003",level:"L4",levelName:"Level 4",category:"Security",question:"Minimum storage for commercial video surveillance?",options:["1 day","7-30 days based on compliance","Maximum available","No minimum"],correct:1,explanation:"Commercial systems typically need 7-30 days based on compliance requirements."},
            {id:"L4-004",level:"L4",levelName:"Level 4",category:"Wireless",question:"Purpose of supervision in wireless security?",options:["Monitor installers","Check devices are still communicating","Record video","Adjust sensitivity"],correct:1,explanation:"Supervision ensures wireless devices are functioning and communicating."},
            {id:"L4-005",level:"L4",levelName:"Level 4",category:"Security",question:"When is hardwire translator preferred?",options:["Never","When converting 8+ hardwired zones","New construction only","Residential only"],correct:1,explanation:"Translators are cost-effective for 8+ hardwired zone takeovers."},
            {id:"L4-006",level:"L4",levelName:"Level 4",category:"Security",question:"Communication redundancy for 24/7 commercial monitoring?",options:["Single cellular","Dual-path: cellular + IP backup","Landline only","No backup"],correct:1,explanation:"Critical commercial needs dual-path (cellular + IP) for redundancy."},
            {id:"L4-007",level:"L4",levelName:"Level 4",category:"Security",question:"Primary consideration for parking lot camera design?",options:["Max zoom only","Lighting, plate capture, wide coverage","Cheapest cameras","Indoor cameras"],correct:1,explanation:"Parking lot design: IR/lighting, plate capture placement, and wide coverage zones."},
            {id:"L4-008",level:"L4",levelName:"Level 4",category:"Wireless",question:"Common US frequency for residential security sensors?",options:["433 MHz","900 MHz","319.5 MHz or 345 MHz","2.4 GHz"],correct:2,explanation:"US residential security uses 319.5 MHz or 345 MHz proprietary frequencies."},
            {id:"L4-009",level:"L4",levelName:"Level 4",category:"Safety",question:"What does SDS stand for?",options:["Safety Data Sheet","Standard Delivery Schedule","Security Detection System","Service Documentation"],correct:0,explanation:"SDS = Safety Data Sheet. Contains chemical hazard and handling information."},
            {id:"L4-010",level:"L4",levelName:"Level 4",category:"Security",question:"What is Business Activity Analytics for?",options:["Employee surveillance","Analyzing foot traffic, occupancy, insights","Camera troubleshooting","Billing"],correct:1,explanation:"Business Analytics: foot traffic, occupancy patterns, and operational insights."},
            {id:"L4-011",level:"L4",levelName:"Level 4",category:"NEC",question:"NEC Article 725 covers what type of circuits?",options:["Motor controls","Class 1, Class 2, and Class 3 remote-control circuits","Lighting","Fire alarm"],correct:1,explanation:"NEC 725 covers Class 1, 2, and 3 remote-control, signaling, and power-limited circuits."},
            {id:"L4-012",level:"L4",levelName:"Level 4",category:"NEC",question:"Maximum voltage for Class 2 circuits per NEC 725?",options:["30V, 100VA","50V, 200VA","100V, 500VA","150V, 1000VA"],correct:0,explanation:"Class 2 circuits: max 30V and 100VA. This is why security is 'low-voltage.'"},

            // NEC (20) ‚Äî Code Articles
            {id:"NEC-001",level:"NEC",levelName:"NEC Codes",category:"NEC",question:"NPLFA maximum operating voltage?",options:["150V","300V","600V","1000V"],correct:2,explanation:"Non-Power-Limited Fire Alarm circuits: 600V maximum."},
            {id:"NEC-002",level:"NEC",levelName:"NEC Codes",category:"NEC",question:"Fire alarm cable in plenum spaces must be?",options:["FPL","FPLP","FPLR","Any type"],correct:1,explanation:"Plenum-rated (FPLP) cable required in plenum spaces. No exceptions."},
            {id:"NEC-003",level:"NEC",levelName:"NEC Codes",category:"NEC",question:"PLFA stands for?",options:["Power Line Fire Alarm","Power-Limited Fire Alarm","Primary Line Fire Alarm","Protected Line Fire Alarm"],correct:1,explanation:"PLFA = Power-Limited Fire Alarm."},
            {id:"NEC-004",level:"NEC",levelName:"NEC Codes",category:"NEC",question:"Fire alarm riser cable marking?",options:["FPL","FPLP","FPLR","FPLX"],correct:2,explanation:"Riser-rated fire alarm cable is marked FPLR."},
            {id:"NEC-005",level:"NEC",levelName:"NEC Codes",category:"NEC",question:"Can PLFA and NPLFA circuits share the same raceway?",options:["Yes always","No, not permitted","With a barrier","If same system"],correct:1,explanation:"PLFA and NPLFA circuits cannot share raceway. NEC 760.136."},
            {id:"NEC-006",level:"NEC",levelName:"NEC Codes",category:"NEC",question:"Fire alarm cables must be supported every?",options:["3 feet","4.5 feet","6 feet","Per cable listing"],correct:1,explanation:"Fire alarm cables require support at 4.5-foot intervals."},
            {id:"NEC-007",level:"NEC",levelName:"NEC Codes",category:"NEC",question:"NEC Article 760 covers?",options:["Motor controls","Fire alarm systems","Lighting","Communications"],correct:1,explanation:"NEC 760 covers fire alarm system wiring and installation."},
            {id:"NEC-008",level:"NEC",levelName:"NEC Codes",category:"NEC",question:"NEC Article 800 covers?",options:["Fire alarm","Communications circuits","Motor controls","Grounding"],correct:1,explanation:"NEC 800 covers communications circuits (telephone, data, broadband)."},
            {id:"NEC-009",level:"NEC",levelName:"NEC Codes",category:"NEC",question:"NEC Article 820 covers?",options:["Fire alarm","Communications","Community antenna TV (CATV)","Optical fiber"],correct:2,explanation:"NEC 820 covers CATV (cable TV) systems."},
            {id:"NEC-010",level:"NEC",levelName:"NEC Codes",category:"NEC",question:"NEC Article 770 covers?",options:["Fire alarm","Optical fiber cables","CATV","Motor circuits"],correct:1,explanation:"NEC 770 covers optical fiber cables and raceways."},
            {id:"NEC-011",level:"NEC",levelName:"NEC Codes",category:"NEC",question:"Fire alarm battery backup minimum per NFPA 72?",options:["4 hours","8 hours","24 hours standby + 5 min alarm","48 hours"],correct:2,explanation:"NFPA 72: 24 hours standby + 5 minutes alarm operation minimum."},
            {id:"NEC-012",level:"NEC",levelName:"NEC Codes",category:"NEC",question:"Class 2 cables can share raceway with power cables?",options:["Yes always","No, never","Only if separated by barrier","Only if listed for it"],correct:1,explanation:"Class 2 cables cannot share raceway with power conductors. NEC 725.136."},
            {id:"NEC-013",level:"NEC",levelName:"NEC Codes",category:"NEC",question:"What is the minimum burial depth for Class 2 cable?",options:["4 inches","6 inches","12 inches","18 inches"],correct:1,explanation:"Class 2 cable: minimum 6-inch burial depth per NEC."},
            {id:"NEC-014",level:"NEC",levelName:"NEC Codes",category:"NEC",question:"NEC Annexes are?",options:["Enforceable code","Informational only","State requirements","Optional additions"],correct:1,explanation:"NEC Annexes are informational only, not enforceable code."},
            {id:"NEC-015",level:"NEC",levelName:"NEC Codes",category:"NEC",question:"Circuit integrity fire alarm cable must maintain function for?",options:["15 minutes","30 minutes","1 hour","2 hours"],correct:3,explanation:"Circuit integrity cables maintain operation for 2 hours during fire."},
            {id:"NEC-016",level:"NEC",levelName:"NEC Codes",category:"NEC",question:"NEC Article 250 covers?",options:["Fire alarm","Communications","Grounding and bonding","Low-voltage circuits"],correct:2,explanation:"NEC 250 covers grounding and bonding requirements."},
            {id:"NEC-017",level:"NEC",levelName:"NEC Codes",category:"NEC",question:"NPLFA wiring methods follow which NEC chapter?",options:["Chapter 1","Chapter 2","Chapter 3","Chapter 8"],correct:2,explanation:"Non-Power-Limited Fire Alarm wiring methods follow NEC Chapter 3."},
            {id:"NEC-018",level:"NEC",levelName:"NEC Codes",category:"NEC",question:"NEC Article 830 covers?",options:["Fire alarm","Network-powered broadband","CATV","Optical fiber"],correct:1,explanation:"NEC 830 covers network-powered broadband communications systems."},
            {id:"NEC-019",level:"NEC",levelName:"NEC Codes",category:"NEC",question:"What are the three classes of remote-control circuits per NEC 725?",options:["A, B, C","Low, Medium, High","Class 1, Class 2, Class 3","Type 1, Type 2, Type 3"],correct:2,explanation:"NEC 725 defines Class 1, Class 2, and Class 3 circuits."},
            {id:"NEC-020",level:"NEC",levelName:"NEC Codes",category:"NEC",question:"GFCI protection is required within what distance of a kitchen sink?",options:["3 feet","6 feet","10 feet","All kitchen outlets"],correct:1,explanation:"NEC requires GFCI for kitchen receptacles serving countertop surfaces within 6 feet of the sink."},

            // FIRE ALARM (15) ‚Äî NFPA/NICET
            {id:"FA-001",level:"FIRE",levelName:"Fire Alarm",category:"Fire Alarm",question:"What are the four types of fire alarm initiating devices?",options:["Smoke, heat, manual, sprinkler waterflow","Smoke, gas, manual, flame","Audio, visual, heat, smoke","Ionization, photoelectric, beam, duct"],correct:0,explanation:"Four main types: smoke detectors, heat detectors, manual pull stations, and waterflow switches."},
            {id:"FA-002",level:"FIRE",levelName:"Fire Alarm",category:"Fire Alarm",question:"Photoelectric smoke detectors work best for?",options:["Fast-burning fires","Slow-smoldering fires","Gas leaks","Chemical fires"],correct:1,explanation:"Photoelectric detectors excel at detecting slow-smoldering fires with large particles."},
            {id:"FA-003",level:"FIRE",levelName:"Fire Alarm",category:"Fire Alarm",question:"Ionization smoke detectors work best for?",options:["Slow-smoldering fires","Fast-burning, flaming fires","Gas leaks","Grease fires"],correct:1,explanation:"Ionization detectors respond faster to fast, flaming fires with small particles."},
            {id:"FA-004",level:"FIRE",levelName:"Fire Alarm",category:"Fire Alarm",question:"What is the standard horn/strobe candela for sleeping areas?",options:["15 cd","75 cd","110 cd","177 cd"],correct:2,explanation:"Sleeping areas require 110 cd notification appliances per NFPA 72."},
            {id:"FA-005",level:"FIRE",levelName:"Fire Alarm",category:"Fire Alarm",question:"NAC stands for?",options:["National Alarm Code","Notification Appliance Circuit","Network Access Control","Non-Addressable Circuit"],correct:1,explanation:"NAC = Notification Appliance Circuit. Carries power to horns and strobes."},
            {id:"FA-006",level:"FIRE",levelName:"Fire Alarm",category:"Fire Alarm",question:"IDC stands for?",options:["Internal Data Connection","Initiating Device Circuit","Independent Distribution Center","Input Device Control"],correct:1,explanation:"IDC = Initiating Device Circuit. Connected to detectors and pull stations."},
            {id:"FA-007",level:"FIRE",levelName:"Fire Alarm",category:"Fire Alarm",question:"What color is a fire alarm pull station?",options:["Green","Blue","Red","Yellow"],correct:2,explanation:"Fire alarm pull stations are always RED per NFPA 72."},
            {id:"FA-008",level:"FIRE",levelName:"Fire Alarm",category:"Fire Alarm",question:"Duct detectors are installed where?",options:["In every room","In HVAC ductwork","On ceilings only","At exits"],correct:1,explanation:"Duct detectors sample air in HVAC ductwork to detect smoke in the air handling system."},
            {id:"FA-009",level:"FIRE",levelName:"Fire Alarm",category:"Fire Alarm",question:"What type of fire alarm system identifies the exact device in alarm?",options:["Conventional","Addressable","Zoned","Wireless"],correct:1,explanation:"Addressable systems identify the specific device in alarm by unique address."},
            {id:"FA-010",level:"FIRE",levelName:"Fire Alarm",category:"Fire Alarm",question:"Fixed-temperature heat detectors activate at what common temp?",options:["100¬∞F","135¬∞F","165¬∞F","200¬∞F"],correct:1,explanation:"135¬∞F (57¬∞C) is the most common fixed-temperature rating for commercial heat detectors."},
            {id:"FA-011",level:"FIRE",levelName:"Fire Alarm",category:"Fire Alarm",question:"Rate-of-rise heat detectors activate when temperature rises faster than?",options:["5¬∞F/min","10¬∞F/min","15¬∞F/min","20¬∞F/min"],correct:2,explanation:"Rate-of-rise detectors trigger when temperature increases more than 15¬∞F per minute."},
            {id:"FA-012",level:"FIRE",levelName:"Fire Alarm",category:"Fire Alarm",question:"What wire gauge is standard for fire alarm circuits?",options:["22 AWG","18 AWG","14 AWG","12 AWG"],correct:2,explanation:"14 AWG is standard for fire alarm NAC and power circuits. Some IDC use 18 AWG."},
            {id:"FA-013",level:"FIRE",levelName:"Fire Alarm",category:"Fire Alarm",question:"NICET stands for?",options:["National Institute for Certification in Engineering Technologies","National Inspection Council for Electrical Testing","Network Installation Certification and Training","None of the above"],correct:0,explanation:"NICET = National Institute for Certification in Engineering Technologies."},
            {id:"FA-014",level:"FIRE",levelName:"Fire Alarm",category:"Fire Alarm",question:"Class A wiring provides what benefit?",options:["Lower cost","Redundant path ‚Äî system works even with single wire break","Higher voltage","Faster response"],correct:1,explanation:"Class A provides a redundant return path so the system functions with a single open."},
            {id:"FA-015",level:"FIRE",levelName:"Fire Alarm",category:"Fire Alarm",question:"How often must fire alarm systems be tested per NFPA 72?",options:["Monthly","Quarterly","Semi-annually","Annually"],correct:3,explanation:"NFPA 72 requires annual testing of fire alarm systems, with some components requiring more frequent checks."},

            // VOLTAGE DROP (10) ‚Äî Calculation focused
            {id:"VD-001",level:"VD",levelName:"Voltage Drop",category:"Electrical",question:"The voltage drop formula is?",options:["VD = V √ó I","VD = (2 √ó K √ó I √ó D) / CM","VD = I √ó R","VD = P / I"],correct:1,explanation:"VD = (2 √ó K √ó I √ó D) / CM. The '2' accounts for round-trip wire length."},
            {id:"VD-002",level:"VD",levelName:"Voltage Drop",category:"Electrical",question:"K factor for copper conductor?",options:["10.4","12.9","21.2","25.6"],correct:1,explanation:"K = 12.9 for copper. K = 21.2 for aluminum."},
            {id:"VD-003",level:"VD",levelName:"Voltage Drop",category:"Electrical",question:"The '2' in the voltage drop formula represents?",options:["Safety factor","Round trip (out and back)","Phase factor","Derating"],correct:1,explanation:"The '2' accounts for both the outgoing and return wire ‚Äî the full round trip."},
            {id:"VD-004",level:"VD",levelName:"Voltage Drop",category:"NEC",question:"NEC recommended max voltage drop for branch circuits?",options:["2%","3%","5%","10%"],correct:1,explanation:"NEC recommends max 3% drop for branch circuits, 5% total (feeder + branch)."},
            {id:"VD-005",level:"VD",levelName:"Voltage Drop",category:"Electrical",question:"Circular mils for 18 AWG wire?",options:["640","1,020","1,620","2,580"],correct:2,explanation:"18 AWG = 1,620 circular mils."},
            {id:"VD-006",level:"VD",levelName:"Voltage Drop",category:"Electrical",question:"3% of 24V equals?",options:["0.48V","0.72V","0.96V","1.20V"],correct:1,explanation:"24 √ó 0.03 = 0.72V maximum allowable drop."},
            {id:"VD-007",level:"VD",levelName:"Voltage Drop",category:"Electrical",question:"If you double the wire run distance, voltage drop will?",options:["Stay same","Double","Halve","Quadruple"],correct:1,explanation:"Distance is directly proportional ‚Äî double distance = double voltage drop."},
            {id:"VD-008",level:"VD",levelName:"Voltage Drop",category:"Electrical",question:"If you double the wire size (CM), voltage drop will?",options:["Stay same","Double","Halve","Quadruple"],correct:2,explanation:"Wire size (CM) is inversely proportional ‚Äî double CM = half the voltage drop."},
            {id:"VD-009",level:"VD",levelName:"Voltage Drop",category:"Electrical",question:"Circular mils for 14 AWG?",options:["2,580","4,110","6,530","10,380"],correct:1,explanation:"14 AWG = 4,110 circular mils."},
            {id:"VD-010",level:"VD",levelName:"Voltage Drop",category:"Electrical",question:"K factor for aluminum conductor?",options:["10.4","12.9","21.2","25.6"],correct:2,explanation:"K = 21.2 for aluminum. Higher than copper because aluminum has more resistance."}
        ];

        // ==========================================
        // STATE
        // ==========================================
        let state = {user:null,xp:0,streak:0,totalAnswered:0,totalCorrect:0,cardsReviewed:0,sessions:0,levelStats:{FUND:{a:0,c:0},L1:{a:0,c:0},L2:{a:0,c:0},L3:{a:0,c:0},L4:{a:0,c:0},NEC:{a:0,c:0},FIRE:{a:0,c:0},VD:{a:0,c:0}}};
        let quizState = {active:false,questions:[],index:0,correct:0,incorrect:0,category:null};
        let flashcardState = {active:false,cards:[],index:0};
        let currentFilter = 'all';

        // ==========================================
        // THEME
        // ==========================================
        function initTheme(){const s=localStorage.getItem('ssu_qc_theme')||'dark';setTheme(s);}
        function toggleTheme(){const c=document.documentElement.getAttribute('data-theme');const n=c==='dark'?'light':'dark';setTheme(n);localStorage.setItem('ssu_qc_theme',n);}
        function setTheme(t){document.documentElement.setAttribute('data-theme',t);document.getElementById('theme-icon').textContent=t==='dark'?'üåô':'‚òÄÔ∏è';document.getElementById('theme-label').textContent=t==='dark'?'DARK':'LIGHT';}

        // ==========================================
        // NAVIGATION
        // ==========================================
        function showLanding(){document.getElementById('landing-page').classList.remove('hidden');document.getElementById('login-page').classList.remove('active');document.getElementById('app-wrapper').classList.remove('active');}
        function showLogin(){document.getElementById('landing-page').classList.add('hidden');document.getElementById('login-page').classList.add('active');document.getElementById('app-wrapper').classList.remove('active');}
        function showApp(){document.getElementById('landing-page').classList.add('hidden');document.getElementById('login-page').classList.remove('active');document.getElementById('app-wrapper').classList.add('active');updateUI();}
        function showSection(id){document.querySelectorAll('.app-section').forEach(s=>s.classList.remove('active'));document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('active'));document.getElementById('section-'+id).classList.add('active');document.querySelector('[data-section="'+id+'"]').classList.add('active');if(id!=='quiz')endQuiz();if(id!=='flashcards')endFlashcards();}
        function togglePassword(id,btn){const i=document.getElementById(id);if(i.type==='password'){i.type='text';btn.textContent='üôà';}else{i.type='password';btn.textContent='üëÅÔ∏è';}}

        // ==========================================
        // LOGIN
        // ==========================================
        function handleLogin(){
            try{
                var eid=document.getElementById('login-employee-id').value.trim();
                var pw=document.getElementById('login-password').value;
                var nm=document.getElementById('login-name').value.trim();
                if(!eid||!pw||!nm){showLoginError('Fill in all fields, tech.');return;}
                if(pw.length<4){showLoginError('Password needs at least 4 characters.');return;}
                state.user={employeeId:eid,name:nm};
                try{if(document.getElementById('remember-me').checked)localStorage.setItem('ssu_qc_user',JSON.stringify(state.user));else sessionStorage.setItem('ssu_qc_user',JSON.stringify(state.user));}catch(e){}
                var init=nm.split(' ').map(n=>n[0]).join('').toUpperCase();
                document.getElementById('userAvatar').textContent=init;
                document.getElementById('userName').textContent=nm;
                hideLoginError();showApp();
            }catch(err){showLoginError('Error: '+err.message);}
        }
        function showLoginError(m){const e=document.getElementById('login-error');e.textContent=m;e.classList.add('show');}
        function hideLoginError(){document.getElementById('login-error').classList.remove('show');}
        function logout(){if(confirm('Logout?')){localStorage.removeItem('ssu_qc_user');sessionStorage.removeItem('ssu_qc_user');state.user=null;showLanding();}}
        function checkExistingSession(){const u=localStorage.getItem('ssu_qc_user')||sessionStorage.getItem('ssu_qc_user');if(u){state.user=JSON.parse(u);const init=state.user.name.split(' ').map(n=>n[0]).join('').toUpperCase();document.getElementById('userAvatar').textContent=init;document.getElementById('userName').textContent=state.user.name;showApp();}loadState();}

        // ==========================================
        // MODALS
        // ==========================================
        function showForgotModal(){document.getElementById('forgot-modal').classList.add('show');}
        function closeForgotModal(){document.getElementById('forgot-modal').classList.remove('show');}
        function showInfoModal(){document.getElementById('info-modal').classList.add('show');}
        function closeInfoModal(){document.getElementById('info-modal').classList.remove('show');}

        // ==========================================
        // STATE MANAGEMENT
        // ==========================================
        function loadState(){try{const s=localStorage.getItem('ssu_qc_state');if(s)state={...state,...JSON.parse(s)};}catch(e){}}
        function saveState(){try{localStorage.setItem('ssu_qc_state',JSON.stringify(state));}catch(e){}}

        // ==========================================
        // UI UPDATE
        // ==========================================
        function updateUI(){
            document.getElementById('statXP').textContent=state.xp;
            document.getElementById('statStreak').textContent=state.streak;
            document.getElementById('statSessions').textContent=state.sessions;
            const lvl=state.xp<500?'FUNDAMENTALS':state.xp<1500?'LEVEL 1':state.xp<3000?'LEVEL 2':state.xp<5000?'LEVEL 3':'LEVEL 4';
            document.getElementById('userLevel').textContent=lvl;
            const levels=['FUND','L1','L2','L3','L4','NEC','FIRE','VD'];
            levels.forEach(l=>{const s=state.levelStats[l];const el=document.getElementById('prog'+l);if(el)el.textContent=s&&s.a>0?Math.round(s.c/s.a*100)+'%':'0%';});
            // Category counts
            const cats=['Safety','Electrical','Security','Fire','NEC','Wiring','Tools'];
            cats.forEach(c=>{const el=document.getElementById('cat'+c);if(el)el.textContent=questionDatabase.filter(q=>q.category.includes(c)).length+' questions';});
            const allEl=document.getElementById('catAll');if(allEl)allEl.textContent=questionDatabase.length+' questions';
            renderQuestionBank();
        }

        // ==========================================
        // QUIZ ENGINE
        // ==========================================
        function shuffleArray(arr){for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];}return arr;}

        function startLevelQuiz(level){
            const qs=shuffleArray(questionDatabase.filter(q=>q.level===level)).slice(0,15);
            if(!qs.length){alert('No questions for this level.');return;}
            quizState={active:true,questions:qs,index:0,correct:0,incorrect:0,category:level};
            showSection('quiz');
            document.getElementById('quiz-setup').classList.add('hidden');
            document.getElementById('quiz-active').classList.remove('hidden');
            document.getElementById('quiz-results').classList.add('hidden');
            renderQuizQuestion();
        }
        function startCategoryQuiz(cat){
            let qs=cat==='all'?shuffleArray([...questionDatabase]).slice(0,10):shuffleArray(questionDatabase.filter(q=>q.category.includes(cat))).slice(0,10);
            if(!qs.length){alert('No questions for this category.');return;}
            quizState={active:true,questions:qs,index:0,correct:0,incorrect:0,category:cat};
            showSection('quiz');
            document.getElementById('quiz-setup').classList.add('hidden');
            document.getElementById('quiz-active').classList.remove('hidden');
            document.getElementById('quiz-results').classList.add('hidden');
            renderQuizQuestion();
        }

        function renderQuizQuestion(){
            const q=quizState.questions[quizState.index];const total=quizState.questions.length;
            document.getElementById('quizProgress').textContent='Question '+(quizState.index+1)+' of '+total;
            document.getElementById('quizProgressBar').style.width=((quizState.index+1)/total*100)+'%';
            document.getElementById('quizScore').textContent='‚úì '+quizState.correct+' | ‚úó '+quizState.incorrect;
            document.getElementById('quizNextBtn').classList.add('hidden');
            const letters=['A','B','C','D'];
            let html='<div class="question-card"><div class="question-meta"><span class="question-level" style="background:var(--bg-input);color:var(--text-secondary);">'+q.levelName+'</span><span class="question-category">'+q.category+'</span></div><div class="question-text">'+q.question+'</div><div class="answer-options">';
            q.options.forEach((opt,i)=>{html+='<div class="answer-option" data-index="'+i+'" onclick="selectAnswer('+i+')"><div class="option-letter">'+letters[i]+'</div><div class="option-text">'+opt+'</div></div>';});
            html+='</div><div class="explanation" id="quizExplanation"><div class="explanation-title">EXPLANATION</div><p>'+q.explanation+'</p></div></div>';
            document.getElementById('quizQuestionContainer').innerHTML=html;
        }

        function selectAnswer(idx){
            const q=quizState.questions[quizState.index];
            if(document.querySelector('.answer-option.disabled'))return;
            const opts=document.querySelectorAll('.answer-option');
            opts.forEach(o=>{o.classList.add('disabled');const i=parseInt(o.dataset.index);if(i===q.correct)o.classList.add('correct');if(i===idx&&i!==q.correct)o.classList.add('incorrect');});
            opts[idx].classList.add('selected');
            document.getElementById('quizExplanation').classList.add('show');
            state.totalAnswered++;
            if(state.levelStats[q.level])state.levelStats[q.level].a++;
            if(idx===q.correct){quizState.correct++;state.totalCorrect++;state.xp+=10;state.streak++;if(state.levelStats[q.level])state.levelStats[q.level].c++;}
            else{quizState.incorrect++;state.xp+=3;state.streak=0;}
            document.getElementById('quizScore').textContent='‚úì '+quizState.correct+' | ‚úó '+quizState.incorrect;
            if(quizState.index<quizState.questions.length-1)document.getElementById('quizNextBtn').classList.remove('hidden');
            else setTimeout(showQuizResults,1500);
            saveState();updateUI();
        }

        function nextQuizQuestion(){quizState.index++;renderQuizQuestion();}
        function showQuizResults(){
            state.sessions++;
            document.getElementById('quiz-active').classList.add('hidden');
            document.getElementById('quiz-results').classList.remove('hidden');
            const total=quizState.questions.length;const pct=Math.round(quizState.correct/total*100);
            const xp=quizState.correct*10+quizState.incorrect*3;
            document.getElementById('quizFinalScore').textContent=pct+'%';
            document.getElementById('quizCorrect').textContent=quizState.correct;
            document.getElementById('quizIncorrect').textContent=quizState.incorrect;
            document.getElementById('quizXPEarned').textContent=xp;
            document.getElementById('quizResultsIcon').textContent=pct>=80?'üèÜ':pct>=60?'üéØ':'üìö';
            document.getElementById('quizResultsTitle').textContent=pct>=80?'Excellent!':pct>=60?'Good Job!':'Keep Practicing!';
            saveState();updateUI();
        }
        function retakeQuiz(){startCategoryQuiz(quizState.category);}
        function endQuiz(){quizState.active=false;document.getElementById('quiz-setup').classList.remove('hidden');document.getElementById('quiz-active').classList.add('hidden');document.getElementById('quiz-results').classList.add('hidden');}

        // ==========================================
        // FLASHCARDS
        // ==========================================
        function startFlashcards(cat){
            let cards=cat==='all'?shuffleArray([...questionDatabase]).slice(0,15):shuffleArray(questionDatabase.filter(q=>q.category.includes(cat))).slice(0,15);
            if(!cards.length){alert('No cards for this category.');return;}
            flashcardState={active:true,cards,index:0};
            document.getElementById('flashcard-setup').classList.add('hidden');
            document.getElementById('flashcard-active').classList.remove('hidden');
            renderFlashcard();
        }
        function renderFlashcard(){
            const c=flashcardState.cards[flashcardState.index];
            document.getElementById('flashcardProgress').textContent='Card '+(flashcardState.index+1)+' of '+flashcardState.cards.length;
            document.getElementById('flashcardQuestion').textContent=c.question;
            document.getElementById('flashcardAnswer').textContent=c.options[c.correct];
            document.getElementById('flashcard').classList.remove('flipped');
        }
        function flipCard(){document.getElementById('flashcard').classList.toggle('flipped');}
        function markCard(correct){state.cardsReviewed++;if(correct)state.xp+=5;saveState();updateUI();nextFlashcard();}
        function nextFlashcard(){if(flashcardState.index<flashcardState.cards.length-1){flashcardState.index++;renderFlashcard();}else{alert('Flashcard session complete! Cards: '+flashcardState.cards.length);endFlashcards();}}
        function endFlashcards(){flashcardState.active=false;document.getElementById('flashcard-setup').classList.remove('hidden');document.getElementById('flashcard-active').classList.add('hidden');}

        // ==========================================
        // QUESTION BANK
        // ==========================================
        function setFilter(f){currentFilter=f;document.querySelectorAll('.filter-btn').forEach(b=>b.classList.toggle('active',b.dataset.filter===f));filterQuestions();}
        function filterQuestions(){
            const s=document.getElementById('questionSearch').value.toLowerCase();
            let f=currentFilter==='all'?[...questionDatabase]:questionDatabase.filter(q=>q.level===currentFilter);
            if(s)f=f.filter(q=>q.question.toLowerCase().includes(s)||q.explanation.toLowerCase().includes(s)||q.category.toLowerCase().includes(s));
            renderQuestionList(f);
        }
        function renderQuestionBank(){renderQuestionList(questionDatabase);}
        function renderQuestionList(qs){
            const c=document.getElementById('questionList');
            if(!qs.length){c.innerHTML='<p style="color:var(--text-muted);padding:2rem;text-align:center;">No questions match your search.</p>';return;}
            c.innerHTML=qs.map(q=>'<div class="question-item" onclick="showQuestionDetail(\''+q.id+'\')"><div class="question-item-header"><span class="question-item-category">'+q.category+'</span><span class="question-item-level">'+q.levelName+'</span></div><div class="question-item-text">'+q.question+'</div></div>').join('');
        }
        function showQuestionDetail(id){const q=questionDatabase.find(q=>q.id===id);if(!q)return;alert('üìù '+q.levelName+' ‚Äî '+q.category+'\n\nQ: '+q.question+'\n\n‚úì Answer: '+q.options[q.correct]+'\n\nüí° '+q.explanation);}

        // ==========================================
        // CALCULATORS
        // ==========================================
        const wireCM={22:640,20:1020,18:1620,16:2580,14:4110,12:6530,10:10380,8:16510};

        function calcOhms(){
            const v=document.getElementById('ohmsV').value?parseFloat(document.getElementById('ohmsV').value):null;
            const i=document.getElementById('ohmsI').value?parseFloat(document.getElementById('ohmsI').value):null;
            const r=document.getElementById('ohmsR').value?parseFloat(document.getElementById('ohmsR').value):null;
            let result='';
            if(v!==null&&i!==null&&r===null)result='<b>R = V / I = '+v+' / '+i+' = '+(v/i).toFixed(3)+' Œ©</b>';
            else if(v!==null&&r!==null&&i===null)result='<b>I = V / R = '+v+' / '+r+' = '+(v/r).toFixed(3)+' A</b>';
            else if(i!==null&&r!==null&&v===null)result='<b>V = I √ó R = '+i+' √ó '+r+' = '+(i*r).toFixed(3)+' V</b>';
            else result='Enter exactly 2 values, leave 1 blank.';
            document.getElementById('ohmsResult').innerHTML=result;
        }

        function calcVD(){
            const voltage=parseFloat(document.getElementById('vdVoltage').value);
            const amps=parseFloat(document.getElementById('vdAmps').value);
            const awg=document.getElementById('vdWire').value;
            const dist=parseFloat(document.getElementById('vdDistance').value);
            const k=parseFloat(document.getElementById('vdMaterial').value);
            const cm=wireCM[awg];
            const vd=(2*k*amps*dist)/cm;
            const pct=(vd/voltage*100).toFixed(2);
            const ok=parseFloat(pct)<=3;
            document.getElementById('vdResult').innerHTML='<b>Voltage Drop: '+vd.toFixed(3)+'V ('+pct+'%)</b><br>'+
                'Arriving Voltage: '+(voltage-vd).toFixed(2)+'V<br>'+
                'Status: <span style="color:'+(ok?'var(--accent-green)':'var(--accent-red)')+'">'+(ok?'‚úì PASS ‚Äî within 3%':'‚úó FAIL ‚Äî exceeds 3%')+'</span><br>'+
                '<small>Formula: (2 √ó '+k+' √ó '+amps+' √ó '+dist+') / '+cm+' = '+vd.toFixed(3)+'V</small>';
        }

        function calcPower(){
            const v=document.getElementById('pwrV').value?parseFloat(document.getElementById('pwrV').value):null;
            const i=document.getElementById('pwrI').value?parseFloat(document.getElementById('pwrI').value):null;
            const r=document.getElementById('pwrR').value?parseFloat(document.getElementById('pwrR').value):null;
            let result='';
            if(v!==null&&i!==null)result='<b>P = V √ó I = '+v+' √ó '+i+' = '+(v*i).toFixed(2)+' W</b>';
            else if(i!==null&&r!==null)result='<b>P = I¬≤ √ó R = '+i+'¬≤ √ó '+r+' = '+(i*i*r).toFixed(2)+' W</b>';
            else if(v!==null&&r!==null)result='<b>P = V¬≤ / R = '+v+'¬≤ / '+r+' = '+(v*v/r).toFixed(2)+' W</b>';
            else result='Enter any 2 values to calculate power.';
            document.getElementById('pwrResult').innerHTML=result;
        }

        function calcBattery(){
            const ah=parseFloat(document.getElementById('batAh').value);
            const v=parseFloat(document.getElementById('batV').value);
            const load=parseFloat(document.getElementById('batLoad').value);
            const derate=parseFloat(document.getElementById('batDerate').value);
            const effective=ah*derate;
            const hours=effective/load;
            const wh=ah*v;
            document.getElementById('batResult').innerHTML='<b>Standby Time: '+hours.toFixed(1)+' hours</b><br>'+
                'Effective Capacity: '+effective.toFixed(1)+' Ah ('+Math.round(derate*100)+'% derating)<br>'+
                'Energy Capacity: '+wh.toFixed(0)+' Wh<br>'+
                '<small>NFPA 72 requires 24hr standby + 5min alarm</small>';
        }

        // ==========================================
        // DATA
        // ==========================================
        function exportData(){const b=new Blob([JSON.stringify(state,null,2)],{type:'application/json'});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download='ssu-qc-training-'+new Date().toISOString().split('T')[0]+'.json';a.click();URL.revokeObjectURL(u);}
        function resetData(){if(confirm('Reset ALL progress? This cannot be undone.')){localStorage.removeItem('ssu_qc_state');location.reload();}}

        // ==========================================
        // INIT
        // ==========================================
        document.getElementById('forgot-modal').addEventListener('click',function(e){if(e.target===this)closeForgotModal();});
        document.getElementById('info-modal').addEventListener('click',function(e){if(e.target===this)closeInfoModal();});
        document.addEventListener('DOMContentLoaded',function(){initTheme();checkExistingSession();});
    </script>
</body>
</html>